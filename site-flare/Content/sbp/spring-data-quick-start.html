<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
<head></head>
<body>
<h1>Quick Start</h1>
  

<p>This guide will walk you through the steps of building a Spring Data application with   XAP. You will use the   Spring Data XAP library to store and retrieve POJOs.</p>

<h1><a name="installation">&#160;</a>Installation</h1>

<p>Before using this guide, you have to download <a href="http://www.gigaspaces.com/xap-download">GigaSpaces XAP</a> and install the maven plugin. If you're not familiar with Maven, refer to <a href="https://spring.io/guides/gs/maven/">Building Java Projects with Maven</a>.</p>

<p>To install the XAP maven plugin run the <code>installmavenrep</code> script:</p>

<div class="easyui-tabs" plain="true" data-options=""><div title=" Windows" style="padding:10px"><pre><code class="language-bash">/tools/maven/installmavenrep.bat
</code></pre>
</div>

<div title=" Unix" style="padding:10px"><pre><code class="language-bash">/tools/maven/installmavenrep.sh
</code></pre>
</div>
</div>

<p>Download the <a href="https://github.com/Gigaspaces/xap-spring-data">xap-spring-data</a> project and build it with maven using <code>mvn clean install</code>.</p>

<p>The recommended way to get started using spring-data-xap in your project is with a dependency management system - the snippet below can be copied and pasted into your build.</p>

<pre><code class="language-xml">    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
            &lt;artifactId&gt;spring-data-xap&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>

<h1><a name="define-a-simple-entity">&#160;</a>Define a simple entity</h1>

<p>GigaSpaces XAP is an IMC platform with a powerful In-Memory Data Grid. It stores data in Spaces, and each Space can be configured in a different manner (replicated, partitioned etc). With this example we will use an <code>Embedded Space</code> that is running as part of your program. There is no need to run a separate grid.</p>

<p>With this example, we store <code>Book</code> objects.</p>

<pre><code class="language-java">
package hello;

import com.gigaspaces.annotation.pojo.SpaceClass;
import com.gigaspaces.annotation.pojo.SpaceId;

import java.io.Serializable;

@SpaceClass
public class Book implements Serializable {

    String id;

    String author;

    Integer copies;

    public Book(){}

    public Book(String id, String author, Integer copies) {
        this.id = id;
        this.author = author;
        this.copies = copies;
    }


    public String getAuthor() {
        return author;
    }

    public void setAuthor(String author) {
        this.author = author;
    }

    @SpaceId(autoGenerate = false)
    public String getId() {
        return id;
    }

    public void setId(String id) {
        this.id = id;
    }

    public Integer getCopies() {
        return copies;
    }

    public void setCopies(Integer copies) {
        this.copies = copies;
    }

    @Override
    public String toString() {
        return "Book{" +
                "id='" + id + '\'' +
                ", author='" + author + '\'' +
                ", copies=" + copies +
                '}';
    }
}
</code></pre>

<p>Here you have a <code>Book</code> class with three attributes, the <code>id</code>, the <code>author</code> and the <code>copies</code>. You also have the constructor to populate the entities when creating a new instance and the default constructor.</p>

<p>Notice that this class is annotated <code>@SpaceClass</code>. This annotation is not mandatory, you can write objects to the Space without it, but it's used to provide an additional <a href="/xap/14.0/dev-java/modeling-your-data.html">metadata</a>.
This class also has a getter for <code>id</code> marked with <code>@SpaceId</code>. This property uniquely identifies the object within the Space, and is similar to a primary key in a database.</p>

<p>The next important piece is the number of book copies. Later in this guide, you will use it to demonstrate some queries.
The convenient <code>toString()</code> method will print out the book's id, author and copies.</p>

<h1><a name="create-simple-queries">&#160;</a>Create simple queries</h1>

<p>Spring Data XAP focuses on storing data in XAP. It also inherits powerful functionality from the <code>Spring Data Commons</code> project, such as the ability to derive queries. Essentially, you don't have to learn the query language of   XAP; you can simply write a handful of methods and the queries are generated for you.</p>

<p>To see how this works, lets create an interface that queries <code>Book</code> space objects.</p>

<pre><code class="language-java">
package hello;

import org.springframework.data.repository.CrudRepository;

import java.util.List;

public interface BookRepository extends CrudRepository&lt;Book, String&gt; {

    List&lt;Book&gt; findByAuthor(String author);

    List&lt;Book&gt; findByCopiesLessThan(Integer copies);

    List&lt;Book&gt; findByAuthorOrCopiesGreaterThan(String author, Integer copies);

}
</code></pre>

<p><code>BookRepository</code> extends the <code>CrudRepository</code> interface and plugs in the type of values and keys with: <code>Book</code> and <code>String</code>. Out-of-the-box, this interface comes with many operations, including standard CRUD (create-read-update-delete).</p>

<p>You can define other queries as needed by simply declaring their method signature. In this case, you add <code>findByAuthor</code>, which essentially seeks entities of type <code>Book</code> and find the ones that matches on <code>Author</code>.</p>

<p>You also have:</p>

<ul>
<li><code>findByCopiesLessThan</code> to find books with a number of copies below a certain number</li>
<li><code>findByAuthorOrCopiesGreaterThan</code> to find books with a certain author or number of copies above a certain number</li>
</ul>

<p>Let's wire this up and see what it looks like!</p>

<h1><a name="create-your-program">&#160;</a>Create your Program</h1>

<p>Here you create the Program class with all the components.</p>

<pre><code class="language-java">
package hello;

import org.openspaces.core.GigaSpace;
import org.openspaces.core.GigaSpaceConfigurer;
import org.openspaces.core.space.UrlSpaceConfigurer;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.repository.core.support.RepositoryFactorySupport;

import org.springframework.data.xap.repository.config.EnableXapRepositories;
import org.springframework.data.xap.repository.support.XapRepositoryFactory;

import java.io.IOException;

@Configuration
@EnableXapRepositories
public class Application implements CommandLineRunner {

    @Autowired
    BookRepository bookRepository;

    @Bean
    GigaSpace spaceClient(){
        UrlSpaceConfigurer urlConfigurer = new UrlSpaceConfigurer("/./testSpace");
        return new GigaSpaceConfigurer(urlConfigurer).gigaSpace();
    }

    @Bean
    BookRepository bookRepository(){
        RepositoryFactorySupport factory = new XapRepositoryFactory(spaceClient(), null);
        return factory.getRepository(BookRepository.class);
    }

    @Override
    public void run(String... strings) throws Exception {

        Book thinkingInJava = new Book("1234", "Eccel", 10000);
        Book effectiveJava = new Book("2345", "Bloch", 20000);
        Book springInAction = new Book("3456", "Walls", 50000);

        System.out.println("Before writing objects to space...");
        for (Book book : new Book[] { thinkingInJava, effectiveJava, springInAction }) {
            System.out.println("\t" + book);
        }

        bookRepository.save(thinkingInJava);
        bookRepository.save(effectiveJava);
        bookRepository.save(springInAction);

        System.out.println("Lookup books by author...");
        for (String name : new String[] { thinkingInJava.author, effectiveJava.author, effectiveJava.author}) {
            System.out.println("\t" + bookRepository.findByAuthor(name));
        }

        System.out.println("Lookup for less popular books...");
        for (Book book : bookRepository.findByCopiesLessThan(15000)) {
            System.out.println("\t" + book);
        }

        System.out.println("Lookup for popular books or books of specific author...");
        for (Book book : bookRepository.findByAuthorOrCopiesGreaterThan("Bloch", 30000)) {
            System.out.println("\t" + book);
        }

        System.exit(0);
    }

    public static void main(String[] args) throws IOException {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>

<ul>
<li>In the configuration, you need to add the <code>@EnableXapRepositories</code> annotation. The XAP Space is required to store all data. For that, you have the Spring Data XAP   <code>SpaceClient</code> bean. <br/></li>
<li>The types are <code>&lt;String, Book&gt;</code>, matching the key type (<code>String</code>) with the value type (<code>Book</code>). <br/></li>
<li>The <code>public static void main</code> uses Spring Boot's <code>SpringApplication.run()</code> to launch the application and invoke the <code>CommandLineRunner</code> that builds the relationships. <br/></li>
<li>The application autowires an instance of <code>BookRepository</code> that you just defined. Spring Data XAP will dynamically create a concrete class that implements that interface and will plug in the needed query code to meet the interface's obligations. This repository instance is the used by the <code>run()</code> method to demonstrate the functionality.</li>
</ul>

<div class="tc-admon-note">
  
  <p>The Space is created locally using built-in components and an evaluation license. For a production solutions, it is recommends that you use the production version of XAP, where you can create distributed Spaces across multiple nodes.</p>
</div>

<h1><a name="write-and-read-objects">&#160;</a>Write and Read Objects</h1>

<p>Lets create some <code>Book</code> instances, <span class="tc-bold">SpringInAction</span>, <span class="tc-bold">ThinkingInJava</span>, and <span class="tc-bold">EffectiveJava</span>. Initially, they only exist in memory. After creating them, we store them in the Space.</p>

<p>Now we are ready to run some query:</p>

<ul>
<li>look up books by author<br/></li>
<li>execute query to find less popular books<br/></li>
<li>query to find popular books or books written by specific author</li>
</ul>

<p>You should see something like this:</p>

<pre><code class="language-bash">    Before writing objects to space...
        Book{id='1234', author='Eccel', copies=10000}
        Book{id='2345', author='Bloch', copies=20000}
        Book{id='3456', author='Walls', copies=50000}
    Lookup books by author...
        [Book{id='1234', author='Eccel', copies=10000}]
        [Book{id='2345', author='Bloch', copies=20000}]
        [Book{id='2345', author='Bloch', copies=20000}]
    Lookup for less popular books...
        Book{id='1234', author='Eccel', copies=10000}
    Lookup for popular books or books of specific author...
        Book{id='2345', author='Bloch', copies=20000}
        Book{id='3456', author='Walls', copies=50000}
</code></pre>

</body>
</html>