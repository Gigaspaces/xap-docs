<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
<head></head>
<body>
<h1>WAN Gateway CLI Tool</h1>
  

<table>
<thead>
<tr>
<th>Author</th>
<th>XAP Version</th>
<th>Last Updated</th>
<th>Reference</th>
<th>Download</th>
</tr>
</thead>

<tbody>
<tr>
<td>Skyler Severns, Pavlo Romanenko</td>
<td>10.2.1</td>
<td>December 2015</td>
<td></td>
<td><a href="https://github.com/GigaSpaces-ProfessionalServices/gw-cli">Github link</a></td>
</tr>
</tbody>
</table>

<h1><a name="introduction">&#160;</a>Introduction</h1>

<p>Often there is a need to create and deploy a WAN gateway PU. The process is repeatable
and can be easily automated. To speed it up this tool was created and it takes care
of WAN gateway configuration and deployment.
This tool can be used with master-slave, master-master or any other topology.</p>

<h1><a name="getting-started">&#160;</a>Getting Started</h1>

<h3><a name="download-the-wan-gateway-cli">&#160;</a>Download the WAN Gateway CLI</h3>

<p>You can download the example project  from <a href="/download_files/sbp/WAN_GW_CLI_Example.zip">here</a> and unzip it into an empty folder.</p>

<h3><a name="building-and-running-the-tool">&#160;</a>Building and Running the Tool</h3>

<p><span class="tc-bold">Step 1: Deploy the Space Processing Units</span></p>

<p>Deploy <code>space-de.jar</code> and <code>space-ru.jar</code> via <a href="/xap/14.0/dev-java/deploying-onto-the-service-grid.html">command line or Gigaspaces Management Center</a></p>

<p><span class="tc-bold">Step 2: Build the tool with Maven</span></p>

<p>Modify <code>&lt;gsVersion&gt;</code> within the <code>gw-cli/pom.xml</code> to include the right XAP release -
example below has XAP 10.2.1 (10.2.1-14000-RELEASE) as the <code>&lt;gsVersion&gt;</code> value.
Then execute:</p>

<pre><code class="language-bash">cd &lt;project_root&gt;
mvn clean install
</code></pre>

<p><span class="tc-bold">Step 3: Run the tool to deploy WAN Gateways</span></p>

<p>Tool execution requires configuration file. Two configuration files (<code>wan-gateway-de.conf</code> and <code>wan-gateway-us.conf</code>)
for WAN Gateways for both spaces are provided.</p>

<p>For Windows:</p>

<p>Modify <code>run.ps</code> to point to your XAP installation path instead of <code>D:\gigaspaces-xap-premium-10.2.1-ga</code>.</p>

<pre><code class="language-bash">cd &lt;project_root&gt;
run.ps wan-gateway-de.conf
run.ps wan-gateway-us.conf
</code></pre>

<p>for Linux:</p>

<p>Modify <code>run.sh</code> to point to your XAP installation path instead of `<code>/home/adminuser/gigaspaces-xap-premium-10.2.1-ga</code>.</p>

<pre><code class="language-bash">cd &lt;project_root&gt;
./run.sh wan-gateway-de.conf
./run.sh wan-gateway-us.conf
</code></pre>

<p>Example output:</p>

<pre><code class="language-bash">./run.sh wan-gateway-us.sh
01:02:53.055 [main] INFO  Gateway-CLI - Waiting for operations
01:02:53.167 [main] DEBUG Gateway-CLI - CONNECT: ConnectOptions{username='null', password='null', lookupLocators='null', lookupGroup='pavlo'}
01:02:54.853 [main] DEBUG Gateway-CLI - INITIALIZE: InitializeGatewayParameters{name=US}
01:02:55.901 [main] DEBUG Gateway-CLI - CONFIGURE: ConfigureOptions{gatewayName=US, add=true, remove=false, modify=false, remoteGatewayName='null', communicationPort=null, username='null', password='null', delegator='null', target='null', sink='sink', localSpaceURL='jini://*/*/wanSpaceUS', source='null', requireBootstrap=false, gatewayLookup=false, hostName='null', discoveryPort=null}
01:02:55.978 [main] DEBUG Gateway-CLI - CONFIGURE: ConfigureOptions{gatewayName=US, add=true, remove=false, modify=false, remoteGatewayName='null', communicationPort=null, username='null', password='null', delegator='null', target='null', sink='sink', localSpaceURL='null', source='DE', requireBootstrap=false, gatewayLookup=false, hostName='null', discoveryPort=null}
01:02:56.110 [main] DEBUG Gateway-CLI - CONFIGURE: ConfigureOptions{gatewayName=US, add=true, remove=false, modify=false, remoteGatewayName='null', communicationPort=null, username='null', password='null', delegator='delegator', target='null', sink='null', localSpaceURL='null', source='null', requireBootstrap=false, gatewayLookup=false, hostName='null', discoveryPort=null}
01:02:56.222 [main] DEBUG Gateway-CLI - CONFIGURE: ConfigureOptions{gatewayName=US, add=true, remove=false, modify=false, remoteGatewayName='null', communicationPort=null, username='null', password='null', delegator='delegator', target='DE', sink='null', localSpaceURL='null', source='null', requireBootstrap=false, gatewayLookup=false, hostName='null', discoveryPort=null}
01:02:56.346 [main] DEBUG Gateway-CLI - CONFIGURE: ConfigureOptions{gatewayName=US, add=true, remove=false, modify=false, remoteGatewayName='DE', communicationPort=null, username='null', password='null', delegator='null', target='null', sink='null', localSpaceURL='null', source='null', requireBootstrap=false, gatewayLookup=true, hostName='127.0.0.1', discoveryPort=4174}
01:02:56.437 [main] DEBUG Gateway-CLI - CONFIGURE: ConfigureOptions{gatewayName=US, add=true, remove=false, modify=false, remoteGatewayName='US', communicationPort=null, username='null', password='null', delegator='null', target='null', sink='null', localSpaceURL='null', source='null', requireBootstrap=false, gatewayLookup=true, hostName='127.0.0.1', discoveryPort=4174}
01:02:56.511 [main] DEBUG Gateway-CLI - DEPLOY: DeployOptions{name='US', zone='null', bootStrapSource='null', timeout=3600, xap9=false}
01:02:58.063 [main] DEBUG Gateway-CLI: Deployer - Deploying gateway
01:02:59.693 [main] DEBUG Gateway-CLI: Deployer - Cleaning resources..
01:02:59.700 [main] DEBUG Gateway-CLI: Deployer - Cleaned
01:02:59.700 [main] DEBUG Gateway-CLI: Deployer - Deploy executed
01:02:59.700 [main] DEBUG Gateway-CLI - DISCONNECT
</code></pre>

<p><span class="tc-bold">Step 4: Test the WAN replication</span></p>

<p>Write the data to the first space and see how it's replicated to second one.</p>

<h2><a name="configuration-file-format">&#160;</a>Configuration file format</h2>

<p>Each line of configuration file has the following format:</p>

<pre><code>{command} {parameters}
</code></pre>

<p>Allowed commands: CONFIGURE, DEPLOY, DISCONNECT, INITIALIZE, LINK, BOOTSTRAP, CONNECT.
Please see allowed parameters for each command below.</p>

<h3><a name="connect-options">&#160;</a>connect [<span class="tc-italic">options</span>]</h3>

<p>Sets the connect parameters. Required as the first command to connect to the specified grid, without it all other commands will fail.</p>

<p><span class="tc-bold">Options:</span></p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
<th align="center">Optional/Required</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">-u</td>
<td align="center">–username</td>
<td align="center">Username to authenticate against a secured grid.</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-p</td>
<td align="center">–password</td>
<td align="center">Password to authenticate against a secured grid.</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-l</td>
<td align="center">–lookup-locators</td>
<td align="center">Lookup locator (null for default)</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-g</td>
<td align="center">–lookup-groups</td>
<td align="center">Lookup group (if doesn't set default is used)</td>
<td align="center">optional</td>
</tr>
</tbody>
</table>

<pre><code>connect -u user -p password -l localhost:4174 -g mygroup
</code></pre>

<h3><a name="initialize-options">&#160;</a>initialize [<span class="tc-italic">options</span>]</h3>

<p>Initializes a new gateway. Throws exception, if gateway with the same name was initialized or deployed already.</p>

<p><span class="tc-bold">Options:</span></p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
<th align="center">Optional/Required</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">-n</td>
<td align="center">–name</td>
<td align="center">Gateway site name.</td>
<td align="center">optional</td>
</tr>
</tbody>
</table>

<pre><code>initialize -n SITE-1
</code></pre>

<h3><a name="configure-options">&#160;</a>configure [<span class="tc-italic">options</span>]</h3>

<p>Configures the gateway component or throws an exception if the gateway wasn't initialized.</p>

<p><span class="tc-bold">Options:</span></p>

<p>Use one of three options to add/remove/modify one of gateway configurations.</p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center"></td>
<td align="center">–name</td>
<td align="center">Name of the gateway to configure.</td>
</tr>

<tr>
<td align="center">-a</td>
<td align="center">–add</td>
<td align="center">Add to gateway configuration</td>
</tr>

<tr>
<td align="center">-r</td>
<td align="center">–remove</td>
<td align="center">Remove from gateway configuration</td>
</tr>

<tr>
<td align="center">-m</td>
<td align="center">–modify</td>
<td align="center">Modify gateway configuration</td>
</tr>
</tbody>
</table>

<p><span class="tc-italic">Delegator options:</span></p>

<p>To add/remove delegator use <span class="tc-bold"><span class="tc-italic">-D</span></span> option:</p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
<th align="center">Optional/Required</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">-D</td>
<td align="center">–delegator</td>
<td align="center">Delegator id</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center"></td>
<td align="center">–username</td>
<td align="center">Username</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center"></td>
<td align="center">–password</td>
<td align="center">Password</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-c</td>
<td align="center">–communication-port</td>
<td align="center">Communication port</td>
<td align="center">optional</td>
</tr>
</tbody>
</table>

<pre><code>configure SITE-1 -a -D delegator1 --gateway-lookups lookupsId --c 8000
</code></pre>

<p>To add/remove target to existing delegator.</p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
<th align="center">Optional/Required</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">-D</td>
<td align="center">–delegator</td>
<td align="center">Delegator id</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center"></td>
<td align="center">–target</td>
<td align="center">Target gateway name</td>
<td align="center">required</td>
</tr>
</tbody>
</table>

<pre><code>configure SITE-1 -a -D delegator1 --target SITE-2
</code></pre>

<p><span class="tc-italic">Sink options:</span></p>

<p>To add/remove sink  use <span class="tc-bold"><span class="tc-italic">-S</span></span> option:</p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
<th align="center">Optional/Required</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">-S</td>
<td align="center">–sink</td>
<td align="center">Sink id</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center">-c</td>
<td align="center">–communication-port</td>
<td align="center">Communication port</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center"></td>
<td align="center">–username</td>
<td align="center">Username</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center"></td>
<td align="center">–password</td>
<td align="center">Password</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center"></td>
<td align="center">–local-space-url</td>
<td align="center">Locasl space url</td>
<td align="center">required</td>
</tr>
</tbody>
</table>

<pre><code>    configure SITE-1 -a -S sink1 --c 8000 --local-space-url jini://*/*/wanSpace
</code></pre>

<p>To add/remove source to existing sink.</p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
<th align="center">Optional/Required</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">-S</td>
<td align="center">–sink</td>
<td align="center">Sink id</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center"></td>
<td align="center">–source</td>
<td align="center">Source gateway name</td>
<td align="center">required</td>
</tr>
</tbody>
</table>

<pre><code>configure SITE-1 -a -S sink1 --source SITE-2
</code></pre>

<p><span class="tc-italic">Lookup options:</span></p>

<p>To add/remove/modify lookup use <span class="tc-bold"><span class="tc-italic">-L</span></span> option.</p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
<th align="center">Optional/Required</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">-n</td>
<td align="center">–remote-gateway-name</td>
<td align="center">Name of the remote gateway</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center">-c</td>
<td align="center">–communication-port</td>
<td align="center">Communication port</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-h</td>
<td align="center">–host</td>
<td align="center">Host name</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center">-d</td>
<td align="center">–discovery-port</td>
<td align="center">Discovery port</td>
<td align="center">required</td>
</tr>
</tbody>
</table>

<pre><code>configure SITE-1 -a -L -n SITE2 -h localhost -d 4366 -c 8000
</code></pre>

<h3><a name="deploy-options">&#160;</a>deploy [<span class="tc-italic">options</span>]</h3>

<p>Deploys gateway processing unit. If –source param is specified then replication gateway bootstrapping process will be executed.</p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
<th align="center">Optional/Required</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">-n</td>
<td align="center">–name</td>
<td align="center">Name of the gateway to deploy</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center">-b</td>
<td align="center">–bootstrap-source</td>
<td align="center">Name of the bootstrap source gateway</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-z</td>
<td align="center">–zone</td>
<td align="center">Name of the required zone for deployment</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-t</td>
<td align="center">–bootstrap-timeout</td>
<td align="center">The number of seconds before a boostrap timeout occurs.</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center"></td>
<td align="center">–xap9</td>
<td align="center">Indicates if the resulting gateway should be XAP 9.x or 10.x</td>
<td align="center">optional</td>
</tr>
</tbody>
</table>

<pre><code>deploy SITE-1 --bootstrap-source SITE-2
</code></pre>

<h3><a name="link-options">&#160;</a>link [<span class="tc-italic">options</span>]</h3>

<p>Connects the specified space to a deployed gateway at runtime.</p>

<table>
<thead>
<tr>
<th align="center">Short name</th>
<th align="center">Long name</th>
<th align="center">Description</th>
<th align="center">Optional/Required</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">-a</td>
<td align="center">–add</td>
<td align="center">Adds the gateway target.</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center">-r</td>
<td align="center">–remove</td>
<td align="center">Removes the gateway target.</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center">-n</td>
<td align="center">–name</td>
<td align="center">Target gateway name.</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center">-s</td>
<td align="center">–space-name</td>
<td align="center">Target space.</td>
<td align="center">required</td>
</tr>

<tr>
<td align="center">-b</td>
<td align="center">–bulk-size</td>
<td align="center">Replication bulk size.</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-i</td>
<td align="center">–idle-time-threshold</td>
<td align="center">Max milliseconds between replication.</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-m</td>
<td align="center">–max-redo-capacity</td>
<td align="center">Max redo log count.</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-o</td>
<td align="center">–on-capacity-exceeded</td>
<td align="center">Operation when redo log size exceeded.</td>
<td align="center">optional</td>
</tr>

<tr>
<td align="center">-c</td>
<td align="center">–replicate-change-as-update</td>
<td align="center">Replicates changes as updates.</td>
<td align="center">optional</td>
</tr>
</tbody>
</table>

<pre><code>link --add -n gateway1 -s mySpace1
</code></pre>

<h3><a name="disconnect">&#160;</a>disconnect</h3>

<p>Exits from gateway configuration CLI.</p>

<pre><code>disconnect
</code></pre>

</body>
</html>