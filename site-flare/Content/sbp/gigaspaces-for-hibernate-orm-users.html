<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
<head></head>
<body>
<h1>XAP as Hibernate Second Level Cache</h1>
  

<table>
<thead>
<tr>
<th>Author</th>
<th>XAP Version</th>
<th>Last Updated</th>
<th>Reference</th>
<th>Download</th>
</tr>
</thead>

<tbody>
<tr>
<td>Shay Hassidim</td>
<td>9.6</td>
<td>Feb 2014</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

 <a name="1">&#160;</a>

<p>This page explains how you can use XAP to:</p>

<ul>
<li><span class="tc-bold">Get a free 2nd-level distributed cache</span> for your <a href="http://www.hibernate.org">Hibernate</a>-based database integration</li>
<li><span class="tc-bold">Scale up your database using the existing ORM</span> by adding a GigaSpaces Data Grid with back-end Hibernate integration</li>
</ul>

<p>GigaSpaces as Hibernate 2nd level cache provides:</p>

<ul>
<li>Unlimited cache capacity</li>
<li>All activities be monitored/profiled in real-time</li>
<li>Built-in support for replicated and/or partitioned cache topology</li>
<li>Built-in support for embedded or remote cache</li>
<li>Built-in dynamic scalability</li>
<li>Built-in High-Availability support</li>
<li>Built-in Spring integration</li>
<li>Built-in WAN replication</li>
<li>Built-in security</li>
<li>Built-in deployment environment</li>
<li>Built-in alerting system</li>
</ul>

<p>Read further in this section for more details about these solutions, or jump to detailed instructions: <a href="#step1">how to get a free distributed second-level cache</a> or <a href="#step2">how to add a GigaSpaces data grid</a>.</p>


<div class='bs-callout bs-callout-info'><p>XAP fully supports the <a href="http://www.springframework.org">Spring Framework</a>, and can be plugged in very easily without changing your existing code.</p>
</div>





<h2><a name="the-existing-architecture">&#160;</a>The Existing Architecture</h2>

<p>Your existing Hibernate-based database integration probably looks like the following: the application uses Hibernate to persist its data directly to the database.</p>

<p><img src="/attachment_files/hibernate-with-ehcache.jpg" alt="Hibernate with EhCache.jpg" /></p>

<h2><a name="step-1-getting-a-free-distributed-two-level-cache">&#160;</a>Step 1: Getting a Free Distributed Two-Level Cache</h2>

<p>You can very easily replace your existing Hibernate cache provider, typically EHCache, with GigaSpaces. This gives you a powerful distributed cache with multiple clients.</p>

<p><img src="/attachment_files/HB for community.jpg" alt="HB for community.jpg" /></p>

<p><span class="tc-bold">Benefits:</span></p>

<ul>
<li><span class="tc-bold">Powerful distributed cache</span> - multiple clients, each client's updates can be accessed by all other clients</li>
<li><span class="tc-bold">Effortless integration</span> using Spring</li>
</ul>


<div class='bs-callout bs-callout-info'><p>To learn how to do this, see <a href="#step1">How to Switch Your Second-Level Cache Provider to GigaSpaces</a> below.</p>
</div>





<h2><a name="step-2-scaling-up-your-database-by-adding-a-data-grid">&#160;</a>Step 2: Scaling Up Your Database by Adding a Data Grid</h2>

<p>If you need to scale up your database, you can use GigaSpaces as an In-Memory Data Grid. Your application communicates with the Data Grid using <a href="/xap/14.0/dev-java/the-gigaspace-interface-overview.html">The GigaSpace Interface</a> or the <a href="/xap/14.0/dev-java/map-api.html">Map API</a> interfaces. On the back-end, GigaSpaces persists the data to your existing database using your existing Hibernate O/R mapping in <a href="/xap/14.0/dev-java/asynchronous-persistency-with-the-mirror.html">asynchronous manner</a>.</p>

<p><img src="/attachment_files/Hibernate DataGrid.jpg" alt="Hibernate DataGrid.jpg" /></p>

<p><span class="tc-bold">Benefits:</span></p>

<ul>
<li><span class="tc-bold">Database scalability</span> through partitioning and data distribution - enables higher data volumes and higher throughput with low latency</li>
<li><span class="tc-bold">Better decoupling</span> between your application and the database - no need to hard-wire Hibernate and database concepts into your code and runtime environment</li>
<li><span class="tc-bold">Event-driven</span> model enables notifications when data is modified</li>
<li><span class="tc-bold">Database access can be synchronous or asynchronous</span> - the <a href="/xap/14.0/dev-java/asynchronous-persistency-with-the-mirror.html">GigaSpaces Mirror Service</a> allows data to be persisted to the database asynchronously, without a performance penalty</li>
</ul>


<div class='bs-callout bs-callout-info'><p>To learn how to do this, see the <a href="/sbp/moving-from-hibernate-to-space.html">Moving from Hibernate to Space</a> best practice.</p>
</div>





<h2><a name="beyond-the-data-grid-scaling-out-your-application-using-space-based-architecture">&#160;</a>Beyond the Data Grid: Scaling Out Your Application Using Space-Based Architecture</h2>

<p>To gain ultimate scalability for your application, you can package your business logic together with the GigaSpaces space - which provides not only data but also messaging functionality. This creates a Processing Unit which is completely self sufficient (not dependent on a database, messaging server or any central component), meaning that you to duplicate it as many times as necessary without increasing complexity.</p>

<p>This approach is called Space Based Architecture, and the way to achieve it is the Spring-based OpenSpaces platform, which allows you to deploy your application as a set of services encased in a Processing Unit.</p>

<div class="tc-admon-refer">
  
  <p>To learn more about Space-Based Architecture and its implications, read our white paper, <a href="http://www.gigaspaces.com/WhitePapers">The Scalability Revolution: From Dead End to Open Road</a>.</p>
</div>

<div class="tc-admon-refer">
  
  <p>To learn more about OpenSpaces, see the <a href="/product_overview/product-architecture.html#ProductArchitecture-OpenSpacesAPIandComponents">OpenSpaces</a> section in this online help.</p>
</div>

 <a name="step1">&#160;</a>

<h1><a name="how-to-switch-your-cache-provider-to-gigaspaces-and-gain-distributed-caching">&#160;</a>How to Switch Your Cache Provider to GigaSpaces and Gain Distributed Caching</h1>

<p>This section provides instructions on switching your existing Hibernate local cache, typically EhCache, with GigaSpaces. This will give you a powerful distributed cache with multiple clients and advanced clustering.
<img src="/attachment_files/TwoSteps.jpg" alt="TwoSteps.jpg" /></p>

<p><span class="tc-bold">To switch your Hibernate cache provider to GigaSpaces and use GigaSpaces distributed caching:</span></p>

<ol>
<li>Download the GigaSpaces  <a href="http://www.gigaspaces.com/xap-download">Download Page</a> <br/></li>
<li>Install GigaSpaces. If you need help, refer to the <a href="/xap/14.0/started/installation.html">installation instructions</a>.<br/></li>
<li>This step is different if you are managing your Hibernate configuration using Spring (refer to the Spring documentation, ORM Data Access, section 12.2.2), or directly using <code>hibernate.properties</code> or <code>hibernate.cfg.xml</code>. Select the relevant tab below.</li>
</ol>

<div class="easyui-tabs" plain="true" data-options=""><div title="  Spring Configuration " style="padding:10px"><p><span class="tc-bold">Spring Configuration</span></p>

<p>Edit your SessionFactory Setup. This is the section inside your Spring Application Context File that controls the relevant Hibernate configuration (refer to the <a href="http://static.springframework.org/spring/docs/2.5.x/reference/orm.html">Spring documentation, ORM Data Access</a>, section 12.2.2).</p>

<p><span class="tc-bold">Add or modify</span> the following properties under <code>&lt;property name="hibernateProperties"&gt;</code>:</p>

<div class="tc-align-center"><p>&bull;  Set <code>hibernate.cache.provider_class</code> to <code>org.openspaces.hibernate.cache.SimpleMapCacheProvider</code>:</p>

<pre><code class="language-xml">&lt;prop key="hibernate.cache.provider_class"&gt;
    org.openspaces.hibernate.cache.SimpleMapCacheProvider&lt;/prop&gt;
</code></pre>

<p>&bull;  Set <code>hibernate.cache.use_second_level_cache</code> to <code>true</code>:</p>

<pre><code class="language-xml">&lt;prop key="hibernate.cache.use_second_level_cache"&gt;true&lt;/prop&gt;
</code></pre>

<p>&bull;  Set <code>gigaspace.hibernate.cache.url</code> to <code>/./dataGrid</code>:</p>

<pre><code class="language-xml">&lt;prop key="gigaspace.hibernate.cache.url"&gt;/./dataGrid&lt;/prop&gt;
</code></pre>
</div>
</div>
<div title="  Direct Configuration hibernate.properties " style="padding:10px"><p><span class="tc-bold">Direct Configuration (hibernate.properties</span></p>

<p>Edit your <code>hibernate.properties</code> file. <span class="tc-bold">Add or modify</span> the following properties in the Second-Level Cache section:</p>

<div class="tc-align-center"><p>&bull;  Set <code>hibernate.cache.provider_class</code> to <code>org.openspaces.hibernate.cache.SimpleMapCacheProvider</code>:</p>

<pre><code>hibernate.cache.provider_class org.openspaces.hibernate.cache.SimpleMapCacheProvider
</code></pre>

<p>&bull;  Set <code>hibernate.cache.use_second_level_cache</code> to <code>true</code>:</p>

<pre><code>hibernate.cache.use_second_level_cache true
</code></pre>

<p>&bull;  Set <code>gigaspace.hibernate.cache.url</code> to <code>/./dataGrid</code>:</p>

<pre><code>gigaspace.hibernate.cache.url /./dataGrid
</code></pre>
</div>
</div>
<div title="  Direct Configuration hibernate.cfg.xml " style="padding:10px"><p><span class="tc-bold">Direct Configuration (hibernate.cfg.xml)</span>
Edit your <code>hibernate.cfg.xml</code> file. <span class="tc-bold">Add or modify</span> the following properties under <code>&lt;session-factory&gt;</code>:</p>

<div class="tc-align-center"><p>&bull;  Set <code>hibernate.cache.provider_class</code> to <code>org.openspaces.hibernate.cache.SimpleMapCacheProvider</code>:</p>

<pre><code class="language-xml">&lt;property name="hibernate.cache.provider_class"&gt;
    org.openspaces.hibernate.cache.SimpleMapCacheProvider&lt;/property&gt;
</code></pre>

<ul>
<li>Set <code>hibernate.cache.use_second_level_cache</code> to <code>true</code>:</li>
</ul>

<pre><code class="language-xml">&lt;property name="hibernate.cache.use_second_level_cache"&gt;true&lt;/property&gt;
</code></pre>

<ul>
<li>Set <code>gigaspace.hibernate.cache.url</code> to <code>/./dataGrid</code>:</li>
</ul>

<pre><code class="language-xml">&lt;property name="gigaspace.hibernate.cache.url"&gt;/./dataGrid&lt;/property&gt;
</code></pre>
</div>
</div>
</div>

<div class="tc-admon-note">
  
  <p>The Hibernate second level Cache implementation provided listed below:</p>

<ul>
<li><a href="[%=Links.ApiJavaDoc%]/index.html?org/openspaces/hibernate/cache/SimpleGigaMapCacheProvider.html">org.openspaces.hibernate.cache.SimpleGigaMapCacheProvider</a></li>
<li><a href="[%=Links.ApiJavaDoc%]/index.html?org/openspaces/hibernate/cache/SimpleMapCacheProvider.html">org.openspaces.hibernate.cache.SimpleMapCacheProvider</a></li>
<li><a href="[%=Links.ApiJavaDoc%]/index.html?org/openspaces/hibernate/cache/TransactionalGigaMapCacheProvider.html">org.openspaces.hibernate.cache.TransactionalGigaMapCacheProvider</a></li>
<li><a href="[%=Links.ApiJavaDoc%]/index.html?org/openspaces/hibernate/cache/TransactionalMapCacheProvider.html">org.openspaces.hibernate.cache.TransactionalMapCacheProvider</a></li>
</ul>
</div>

<ol>
<li>Set or add the cache usage (the cache concurrency strategy) in your mapping resource file (<code>*.hbm.xml</code> files) to <code>read-only</code>, <code>read-write</code> or <code>nonstrict-read-write</code>:</li>
</ol>

<pre><code class="language-xml">&lt;class name="your.class.name" table="YourTableName"&gt;
     &lt;cache usage="nonstrict-read-write"/&gt;
</code></pre>

<p>Alternatively, use the <code>&lt;class-cache&gt;</code> and <code>&lt;collection-cache&gt;</code> elements in your hibernate configuration file.</p>

<p>You must include the following JARs from the Hibernate distribution package:</p>

<pre><code>jdbc2_0-stdext.jar; dom4j-XXX.jar; commons-collections-XXX.jar; asm.jar; asm-attrs.jar;
antlr-XXX.jar; ejb3-persistence.jar; hibernate3.jar; hibernate-annotations.jar;
hibernate-commons-annotations.jar
</code></pre>

<ol>
<li>Since your Hibernate objects and their custom type will be eventually be serialized across to wire stored on remote space or replicated into a backup space In-Memoery, these need to be serialized. You should make all your Hibernate objects and their custom fields will be implementing <code>Serializable</code>.</li>
<li>Launch your application. The application should instantiate a local cache based on an embedded GigaSpaces space.</li>
</ol>

<p><img src="/attachment_files/Hibernate with embedded gs.jpg" alt="Hibernate with embedded gs.jpg" /></p>

<ol>
<li>If you want to use GigaSpaces as a distributed cache, select the distributed topology that interests you from the tabs below.</li>
</ol>

<div class="easyui-tabs" plain="true" data-options=""><div title="  Remote Cache " style="padding:10px"><p><span class="tc-bold">Remote Cache Topology</span></p>

<p>In this topology each application accessing a remote cache.</p>

<div class="tc-align-center"><p><img src="/attachment_files/HB Remote GS.jpg" alt="HB Remote GS.jpg" /></p>
</div>

<p><span class="tc-bold">To use the remote cache topology:</span></p>

<ol>
<li>Set your <code>gigaspaces.hibernate.cache.url</code> property to <code>jini://<span class="tc-italic">/</span>/dataGrid</code></li>
<li>Copy <code>dom4j.jar</code> and <code>hibernate3.jar</code> and all relevant Hibernate distribution package libraries into the <code>&lt;GigaSpaces Root&gt;/lib/platform/ext</code> folder.</li>
<li>Run <code>&lt;GigaSpaces Root&gt;\bin\gs-agent.bat (.sh)</code> to start the GigaSpaces <a href="/xap/14.0/admin/the-runtime-environment.html">runtime environment</a>.</li></p>

<p><li><p>Run the deploy command to deploy the remote space:</p>

<p><pre><code>&lt;GigaSpaces root&gt;\bin\gs.bat deploy-space datagrid
</code></pre></li></p>

<p><li><p>Wait to see the following output:</p>

<p><pre><code>Found 1 GSMs
Deploying [datagrid] with name [datagrid] under groups [gigaspaces-7.1.2-XAPPremium-ga] and locators []
SLA Not Found in PU.  Using Default SLA.
Waiting for [1] processing unit instances to be deployed...
[datagrid] [1] deployed successfully on [10.10.254.1]
Finished deploying [1] processing unit instances
</code></pre></li></p>

<p><li><p>Run your application.</p></li>
</ol>
</div>
<div title="  Master-Local Cache " style="padding:10px"><p><span class="tc-bold">Master-Local Cache Topology</span>
In this topology each application has a lightweight, embedded cache, which is initially empty. The first time data is read, it is loaded from a master cache to the local cache (lazy load); the next time the same data is read, it is loaded quickly from the local cache. Later on data is either updated from the master or evicted from the cache.</p>

<div class="tc-align-center"><p><img src="/attachment_files/HB for community.jpg" alt="HB for community.jpg" /></p>
</div>

<p><span class="tc-bold">To use the master-local topology:</span></p>

<ol>
<li>Set your <code>gigaspaces.hibernate.cache.url</code> property to <code>jini://<span class="tc-italic">/</span>/dataGrid?useLocalCache</code></li>
<li>Copy <code>dom4j.jar</code> and <code>hibernate3.jar</code> and all relevant Hibernate distribution package libraries into the <code>&lt;GigaSpaces Root&gt;/lib/platform/ext</code> folder.</li>
<li>Run <code>&lt;GigaSpaces Root&gt;\bin\gs-agent.bat (.sh)</code> to start the GigaSpaces <a href="/xap/14.0/admin/the-runtime-environment.html">runtime environment</a>.</li></p>

<p><li><p>Run the deploy command to deploy the master space:</p>

<p><pre><code>&lt;GigaSpaces root&gt;\bin\gs.bat deploy-space datagrid
</code></pre></li></p>

<p><li><p>Wait to see the following output:</p>

<p><pre><code>Found 1 GSMs
Deploying [datagrid] with name [datagrid] under groups [gigaspaces-7.1.2-XAPPremium-ga] and locators []
SLA Not Found in PU.  Using Default SLA.
Waiting for [1] processing unit instances to be deployed...
[datagrid] [1] deployed successfully on [10.10.254.1]
Finished deploying [1] processing unit instances
</code></pre></li></p>

<p><li><p>Run your application.</p></li>
</ol>
</div>
<div title="  Partitioned Master-Local Cache " style="padding:10px"><p><span class="tc-bold">Partitioned Master-Local Cache Topology</span>
In this topology, data is split between two spaces (partitions) according to an index field defined in the data. An algorithm, defined in the load-balancing policy, maps values of the index field to specific partitions.</p>

<div class='bs-callout bs-callout-info'><p>This topology requires XAP Premium Edition.</p>
</div>

<div class="tc-align-center"><p><img src="/attachment_files/HB Master Local Partitioned GS.jpg" alt="HB Master Local Partitioned GS.jpg" /></p>
</div>

<p><span class="tc-bold">To use the master-local partitioned topology with two partitions:</span></p>

<ol>
<li>Configure your <code>gigaspaces.hibernate.cache.url</code> property to <code>jini://<span class="tc-italic">/</span>/dataGrid?useLocalCache</code></li>
<li>Copy <code>dom4j.jar</code> and <code>hibernate3.jar</code> from Hibernate distribution package into the <code>&lt;GigaSpaces Root&gt;/lib/platform/ext</code> folder.</li>
<li>Run <code>&lt;GigaSpaces Root&gt;\bin\gs-agent.bat (.sh)</code> to start the GigaSpaces <a href="/xap/14.0/admin/the-runtime-environment.html">runtime environment</a>.</li></p>

<p><li><p>Run the deploy command to deploy the master space in cluster of two partitions topology:</p>

<p><pre><code>&lt;GigaSpaces root&gt;\bin\gs.bat deploy-space -cluster schema=partitioned total_members=2,0 datagrid
</code></pre></li></p>

<p><li><p>Wait to see the following output:</p>

<p><pre><code>gs&gt; deploy-space -cluster schema=partitioned total_members=2,0 datagrid
Found 1 GSMs
Deploying [datagrid] with name [datagrid] under groups [gigaspaces-7.1.2-XAPPremium-ga] and locators []
SLA Not Found in PU.  Using Default SLA.
Overrding SLA cluster schema with [partitioned]
Overrding SLA numberOfInstances with [2]
Overrding SLA numberOfBackups with [0]
Waiting for [2] processing unit instances to be deployed...
[datagrid] [1] deployed successfully on [10.10.254.1]
[datagrid] [2] deployed successfully on [10.10.254.1]
Finished deploying [2] processing unit instances
</code></pre></li></p>

<p><li><p>Run your application.</p></li>
</ol>
</div>
<div title="  Embedded Replicated Cache " style="padding:10px"><p><span class="tc-bold">Embedded Replicated Cache Topology</span>
This topology consists of two or more space instances with replication between them, allowing two or more applications to work with their own dedicated data store, while working on the same data as the other applications.</p>

<div class='bs-callout bs-callout-info'><p>This topology requires XAP Premium Edition.</p>
</div>

<div class="tc-align-center"><p><img src="/attachment_files/hibernate-with-2-embedded-replicated.jpg" alt="Hibernate with 2 emedded replicated.jpg" /></p>
</div>

<p><span class="tc-bold">To use the embedded replicated topology with two replicated instances:</span></p>

<ol>
<li><p>In your first application, configure the <code>gigaspaces.hibernate.cache.url</code> property to the following (as one long line):</p>

<p><pre><code>/./dataGrid?cluster_schema=sync_replicated&amp;amp;total_members=2&amp;amp;id=1
</code></pre></li></p>

<p><li><p>Run your first application.</p></li></p>

<p><li><p>In your second application, configure your <code>gigaspaces.hibernate.cache.url</code> property to the following (as one long line):</p>

<p><pre><code>/./dataGrid?cluster_schema=sync_replicated&amp;amp;total_members=2&amp;amp;id=2
</code></pre></li></p>

<p><li><p>Run your second application.</p></li>
</ol>
</div>
</div>

<h2><a name="basic-guidelines">&#160;</a>Basic Guidelines</h2>

<ul>
<li>For the application components that are read/write (up to 50% write/remove/update) you should have the hibernate 2nd local cache to use a remote partitioned space topology.</li>
<li>For the application components that are read mostly (above 50% read) you should have the hibernate 2nd local cache to use a master <a href="/xap/14.0/dev-java/local-cache.html">local cache</a>/<a href="/xap/14.0/dev-java/local-view.html">local view</a> with remote partitioned space topology.</li>
<li>The embedded replicated cache topology is recommended only when having few client applications (up to 3) where the total amount of data can be accommodated within a single JVM and the application is 50% read/write.</li>
<li>For the application components that are write mostly (above 50% write/remove/update), you should <span class="tc-bold">not use hibernate API directly</span> , but move into the <a href="/xap/14.0/dev-java/the-gigaspace-interface-overview.html">GigaSpace  Interface</a> and use the <a href="/xap/14.0/dev-java/asynchronous-persistency-with-the-mirror.html">Mirror service</a> (if you still want to persist the data). In this case you can leverage <a href="/xap/14.0/dev-java/query-sql.html">SQLQuery</a> or <a href="/xap/14.0/dev-java/task-execution-over-the-space.html">Task Executors</a> for complex distributed activities. In this case you should use remote partitioned space topology.</li>
</ul>

<div class="tc-admon-tip">
  
  <p>See the <a href="/sbp/moving-from-hibernate-to-space.html">Moving from Hibernate to Space</a> best practice for step by step instructions moving from Hibernate based application to GigaSpaces Data-Grid as the data access layer.</p>
</div>

<h2><a name="settings-gigaspaces-local-cache-with-hibernate-second-level-cache">&#160;</a>Settings GigaSpaces local cache with Hibernate Second Level Cache</h2>

<p>When using Hibernate Second Level Cache you can configure also GigaSpaces local cache. See below an example for both:</p>

<pre><code class="language-xml">&lt;property name="hibernateProperties"&gt;
   &lt;props&gt;
    &lt;prop key="hibernate.dialect"&gt;org.hibernate.dialect.${jdbc.platform}Dialect&lt;/prop&gt;
    &lt;prop key="hibernate.cache.provider_class"&gt;${hibernate.cache.provider_class}&lt;/prop&gt;
    &lt;prop key="hibernate.show_sql"&gt;{hibernate.show_sql}&lt;/prop&gt;
    &lt;prop key="hibernate.jdbc.batch_size"&gt;${hibernate.jdbc.batch_size}&lt;/prop&gt;
    &lt;prop key="hibernate.cache.use_query_cache"&gt;true&lt;/prop&gt;
    &lt;prop key="hibernate.transaction.flush_before_completion"&gt;true&lt;/prop&gt;
    &lt;prop key="hibernate.generate_statistics"&gt;true&lt;/prop&gt;
    &lt;prop key="hibernate.cache.user_structured_entries"&gt;true&lt;/prop&gt;
    &lt;prop key="hibernate.cache.use_query_cache"&gt;true&lt;/prop&gt;
    &lt;prop key="hibernate.transaction.auto_close_session"&gt;true&lt;/prop&gt;
    &lt;prop key="hibernate.connection.release_mode"&gt;${hibernate.connection.release_mode}&lt;/prop&gt;
    &lt;prop key="hibernate.cache.use_second_level_cache"&gt;true&lt;/prop&gt;
    &lt;prop key="gigaspace.hibernate.cache.url"&gt;jini://*/*/dataGrid?useLocalCache&lt;/prop&gt;

    &lt;prop key="space-config.engine.cache_size"&gt;5000000&lt;/prop&gt;
    &lt;prop key="space-config.engine.memory_usage.high_watermark_percentage"&gt;65&lt;/prop&gt;
    &lt;prop key="space-config.engine.memory_usage.write_only_block_percentage"&gt;63&lt;/prop&gt;
    &lt;prop key="space-config.engine.memory_usage.write_only_check_percentage"&gt;60&lt;/prop&gt;
    &lt;prop key="space-config.engine.memory_usage.low_watermark_percentage"&gt;55&lt;/prop&gt;
    &lt;prop key="space-config.engine.memory_usage.eviction_batch_size"&gt;1000&lt;/prop&gt;
    &lt;prop key="space-config.engine.memory_usage.retry_yield_time"&gt;100&lt;/prop&gt;
    &lt;prop key="space-config.engine.memory_usage.retry_count"&gt;20&lt;/prop&gt;
   &lt;/props&gt;
&lt;/property&gt;
</code></pre>

<h1><a name="custom-hibernate-second-level-cache-implementation">&#160;</a>Custom Hibernate Second Level Cache Implementation</h1>

<p>You may implement your own custom Hibernate Second Level Cache by extending the <a href="[%=Links.ApiJavaDoc%]/index.html?org/openspaces/hibernate/cache/AbstractMapCacheProvider.html">AbstractMapCacheProvider</a> and implementing the <code>buildCache</code> method. The implemented class name should be set as the <code>hibernate.cache.provider_class</code> value. See below example how you may create a custom Hibernate Second Level Cache implementation that will have a different TTL for each cache region:</p>

<pre><code class="language-java">public class CustomMapCacheProvider extends AbstractMapCacheProvider {
    public Cache buildCache(String regionName, Properties properties)  throws CacheException {
    Long ttl = 0l;
    if (regionName.equals(Person.class.getName())) {
        ttl = 60000l; //TODO: make this configurable
    } else if (regionName.equals(Car.class.getName())) {
        ttl = 120000l;
    } else if (regionName.equals(House.class.getName())) {
        ttl = 180000l;
    } else {
        ttl = getTimeToLive();
    }
    return new SimpleMapCache(regionName, getMap(), ttl, getWaitForResponse());
    }
}
</code></pre>

<h1><a name="gigaspaces-hibernate-2nd-level-cache-properties">&#160;</a>GigaSpaces Hibernate 2nd Level Cache Properties</h1>

<p>GigaSpaces Hibernate 2nd Level Cache controlled via the following system properties:</p>

<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Description</th>
<th align="left">Default</th>
<th align="left">Mandatory?</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">gigaspace.hibernate.cache.url</td>
<td align="left"><a href="/xap/14.0/dev-java/the-space-configuration.html">Space URL</a> String. This could be remote (clustered space) with/without a local cache/view URL or embedded space URL. Example:  <code>jini://*/*/mySpace</code></td>
<td align="left"></td>
<td align="left">YES</td>
</tr>

<tr>
<td align="left">gigaspace.hibernate.cache.timeToLive</td>
<td align="left">Time in ms for the cached Hibernate object to live within the space. When you would like to evict Hibernate objects form the space based on a specific time duration, you should set this value.</td>
<td align="left">Long.MAX_VALUE</td>
<td align="left">NO</td>
</tr>

<tr>
<td align="left">gigaspace.hibernate.cache.waitForResponse</td>
<td align="left">Time in ms to wait for a matching object to be written into the space when reading object from the space. When having transactional hibernate configuration you might want to increase this value to allow GigaSpaces to wait for locked objects under a transaction to be committed before rejecting the read operation. A value of 60000 (60 second) might be relevant in such cases.</td>
<td align="left">0</td>
<td align="left">NO</td>
</tr>
</tbody>
</table>

</body>
</html>