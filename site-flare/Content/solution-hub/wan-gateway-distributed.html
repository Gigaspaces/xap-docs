<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1 class="tc-pagetitle">Distributed WAN Gateway</h1>
        <table>
            <col />
            <col />
            <col />
            <col />
            <thead>
                <tr>
                    <th>Author</th>
                    <th>Product Version</th>
                    <th>Reference</th>
                    <th align="center">Download</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Shay  Hassidim</td>
                    <td>12.0.1</td>
                    <td> </td>
                    <td align="center"><a href="https://github.com/Gigaspaces/solution-hub/tree/master/wan-replication_multi_gw" target="_blank">Multi-instance gateway example</a>
                    </td>
                </tr>
            </tbody>
        </table>
        <h1><a name="overview">&#160;</a>Overview</h1>
        <p>By default, a single WAN/LAN gateway instance is used to perform replication from a local Space cluster to a remote Space cluster. For most systems, this provides sufficient throughput to address the activity generated by a single clustered Space. When a system contains large Space clusters or produces a large volume of activity, it may require a distributed (multi-instance) gateway setup.</p>
        <p>The solution described here allows each partition (primary and backup instances) to replicate its activity via a dedicated gateway. In this topology, each partition uses a separate gateway instance that may run on a different machine, utilizing its full CPU and network bandwidth. This approach reduces the likelihood of accumulating a large redolog, which can cause a lag between the source Space and target Space data due to using a single gateway.</p>
        <h1><a name="architecture">&#160;</a>Architecture</h1>
        <p>The example below includes a source Space (New York) with 2 partitions and a target Space (London) with 3 partitions. A gateway running in the New York site has 2 delegator instances, and the London site contains 2 gateway sink instances interacting with the London Space cluster.</p>
        <div class="tc-align-center">
            <p>
                <img src="../Resources/Static/attachment_files/sbp/wan_gateway/distributed-wan-gateway-1.png" alt="image" class="tc-picture50" />
            </p>
        </div>
        <h1><a name="example">&#160;</a>Example</h1>
        <ol>
            <li>Download the <a href="https://github.com/Gigaspaces/solution-hub/tree/master/wan-replication_multi_gw" target="_blank">example</a> and extract its contents (<span class="tc-bold">deploy</span> and <span class="tc-bold">scripts</span> folders) to an empty folder.<ul><li>Deploy - This folder includes the PU folders for the Space and gateway.</li><li>Scripts – This folder includes all the start agents and deploy scripts.</li></ul></li>
            <li>Move the contents of the deploy folder into the <code>&lt;<MadCap:variable name="General.HomePath" />&gt;\deploy</code> folder.</li>
            <li>
                <p>Open the scripts folder and edit the <code>setExampleEnv.bat/sh</code> script to include the machine IP address as the <code><MadCap:variable name="General.EnvVariablePrefix" />_NIC_ADDRESS</code>, and the root folder location as <code><MadCap:variable name="General.HomePath" /></code>.</p>
                <p>The <span class="tc-bold">scripts</span> folder contains the necessary scripts to start the Grid Service Agent for each site, and the <code>deployAll.bat/sh script</code> that is used to automate the deployment of all gateways and Space instances. This allows you to run the entire setup on a single machine.</p>
            </li>
            <li>Run <code>startAgent-GB.bat/sh</code> script to start the GB (London) site agents.</li>
            <li>Run <code>startAgent-US.bat/sh</code> script to start the US (New York) site agents.</li>
            <li>Run <code>deployAll.bat/sh</code> script to deploy the required Processing Units.</li>
        </ol>
        <h2><a name="viewing-the-space-clusters-and-gateways">&#160;</a>Viewing the Space Clusters and Gateways</h2>
        <p>After the US and GB Space clusters and gateways are deployed, you should see the following via the Web Management Console (make sure you use US and GB as the lookup groups when you log in):</p>
        <div class="tc-align-center">
            <p>
                <img src="../Resources/Static/attachment_files/sbp/wan_gateway/distributed-wan-gateway-2.png" alt="image2" class="tc-picture30" />
            </p>
        </div>
        <div class="tc-align-center">
            <p>
                <img src="../Resources/Static/attachment_files/sbp/wan_gateway/distributed-wan-gateway-3.png" alt="image3" class="tc-picture80" />
            </p>
        </div>
        <div class="tc-align-center">
            <p>
                <img src="../Resources/Static/attachment_files/sbp/wan_gateway/distributed-wan-gateway-4.png" alt="image4" class="tc-picture80" />
            </p>
        </div>
        <h2><a name="us-space-pu-xml-configuration">&#160;</a>US Space pu.xml Configuration</h2>
        <p>The US Space pu.xml should include the <code>${clusterInfo.instanceId}</code>, as demonstrated below:</p><pre><code class="language-xml">&lt;os-gateway:targets id="gatewayTargets" local-gateway-name="US${clusterInfo.instanceId}"&gt;
    &lt;os-gateway:target name="GB${clusterInfo.instanceId}" /&gt;
&lt;/os-gateway:targets&gt;
</code></pre>
        <h2><a name="us-gateway-pu-xml-configuration">&#160;</a>US Gateway pu.xml Configuration</h2>
        <p>The US gateway pu.xml should include the <code>${clusterInfo.instanceId}</code>, as demonstrated below:</p><pre><code class="language-xml">&lt;os-gateway:delegator id="delegator" local-gateway-name="US${clusterInfo.instanceId}" gateway-lookups="gatewayLookups"&gt;
        &lt;os-gateway:delegation target="GB${clusterInfo.instanceId}" /&gt;
    &lt;/os-gateway:delegator&gt;
</code></pre>
        <h2><a name="gb-gateway-pu-xml-configuration">&#160;</a>GB Gateway pu.xml Configuration</h2>
        <p>The GB gateway pu.xml should include the <code>${clusterInfo.instanceId}</code>, as demonstrated below:</p><pre><code class="language-xml">&lt;os-gateway:sink id="sink" local-gateway-name="GB${clusterInfo.instanceId}" gateway-lookups="gatewayLookups"
                     local-space-url="jini://*/*/spaceGB"&gt;
     &lt;os-gateway:sources&gt;
            &lt;os-gateway:source name="US${clusterInfo.instanceId}"/&gt;
     &lt;/os-gateway:sources&gt;
&lt;/os-gateway:sink&gt;
</code></pre>
        <h1><a name="limitations">&#160;</a>Limitations</h1>
        <p>Distributed transactions are not supported. Local transactions are supported.</p>
    </body>
</html>