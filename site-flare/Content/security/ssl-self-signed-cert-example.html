<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1 class="tc-pagetitle">Using SSL and Self-Signed Certificates</h1>
        <h1>Overview</h1>
        <p>This section describes a scenario where a <MadCap:variable name="General.CompanyName" /> product is running locally, with a client on a remote server that needs to connect to the <MadCap:variable name="General.CompanyName" /> host machine and write an object to the Space. In order to protect the communication with SSL, we enable the <code>SSLFilterFactory</code> and supply the <code>keystore</code>. We then deploy a Space and run a client. </p>
        <p><MadCap:variable name="General.CompanyName" /> (local) host machine details:</p>
        <ul>
            <li>Operating system: Windows</li>
            <li>Machine name: my-pc.gspaces.com</li>
            <li>IP&#160;address:&#160;10.10.10.131</li>
        </ul>
        <p>Client (remote) machine details:</p>
        <ul>
            <li>Operating system: Linux</li>
            <li>Machine name: blob.gspaces.com</li>
            <li>IP&#160;address: 10.10.10.21</li>
        </ul>
        <h1>Securing the Connection</h1>
        <p>In order to secure the transport layer between the local and remote servers, you must generate a private key and certificate for each server.</p>
        <p class="tc-todo">To secure the connection (transport layer):</p>
        <ol>
            <li>
                <p>On the local server (my-pc), open a command window from the <MadCap:variable name="General.CompanyName" /> bin directory and generate the private key and certificates, as shown using the following code.</p><pre><code class="language-bash">cd &lt;XAP_root&gt;\bin

# generate the private key
keytool -genkeypair -alias server -keyalg RSA -keypass changeit -storepass changeit -keystore keystore.jks 

# export the certificate
keytool -exportcert -alias server -storepass changeit -file server.cer -keystore keystore.jks 
</code></pre>
            </li>
            <li>
                <p>On the remote server (blob), open a command window from the <MadCap:variable name="General.CompanyName" /> bin directory and generate the private key and certificates, as shown using the following code.</p><pre><code class="language-bash">cd &lt;XAP_root&gt;/bin

# generate the private key
keytool -genkeypair -alias client -keyalg RSA -keypass changeit -storepass changeit -keystore client_keystore.jks 

# export the certificate
keytool -exportcert -alias client -storepass changeit -file client.cer -keystore client_keystore.jks 
</code></pre>
            </li>
            <li>
                <p>To upload and exchange the certificates, do the following:</p>
                <ul>
                    <li>Place the server.cer file in <code>blob:&lt;XAP_root&gt;/bin</code></li>
                    <li>Place the client.cer file in <code>my-pc:&lt;XAP_root&gt;/bin</code></li>
                </ul>
            </li>
            <li>
                <p>To import the certificates to the key store, do the following:</p>
                <ul>
                    <li>
                        <p>on <code>my-pc:&lt;XAP_home&gt;/bin</code>, run the following command:</p><pre><code class="language-bash">keytool -importcert -v -trustcacerts -alias client -file client.cer -keystore keystore.jks -keypass changeit -storepass changeit 
</code></pre>
                        <div class="tc-admon-note">
                            <p>For many websites, the recommendation is to put the certificate in the trust store. However, in this scenario we import the certificate directly to the key store.</p>
                        </div>
                    </li>
                </ul>
                <ul>
                    <li>
                        <p>On <code>blob:&lt;XAP_root&gt;/bin</code>, run the following command:</p><pre><code class="language-bash">keytool -importcert -v -trustcacerts -alias server -file server.cer -keystore client_keystore.jks -keypass changeit -storepass changeit 
</code></pre>
                    </li>
                </ul>
            </li>
        </ol>
        <h1>Local Server Setup</h1>
        <p>The local server should have the <code>XAP_LOOKUP_LOCATORS</code>, <code>XAP-NIC_ADDRESS</code>, and <MadCap:conditionalText MadCap:conditions="Version.14-5-died"><code>EXT_JAVA_OPTIONS</code></MadCap:conditionalText><code MadCap:conditions="Version.14-5-born">XAP_OPTIONS_EXT</code> environment variables set as demonstrated in the following  setenv-overrides.bat example. This provides the necessary configuration for the scenario.</p><pre MadCap:conditions="Version.14-5-died"><code class="language-bash">set XAP_LOOKUP_LOCATORS=my-pc.gspaces.com:4174
set XAP_NIC_ADDRESS=10.10.10.131

set </code><code class="language-bash">EXT_JAVA_OPTIONS</code><code class="language-bash">=-Dcom.gs.lrmi.filter.factory=com.gigaspaces.lrmi.nio.filters.SSLFilterFactory -Dcom.gs.lrmi.filter.security.keystore=C:/Users/Dixson/work/xap/gigaspaces-xap-premium-12.0.0-ga-b16000/bin/keystore.jks -Dcom.gs.lrmi.filter.security.password=changeit -Djava.net.preferIPv4Stack=true -Djavax.net.debug=ssl
</code></pre><pre MadCap:conditions="Version.14-5-born"><code class="language-bash">set XAP_LOOKUP_LOCATORS=my-pc.gspaces.com:4174
set XAP_NIC_ADDRESS=10.10.10.131

set </code><code class="language-bash">XAP_OPTIONS_EXT</code><code class="language-bash">=-Dcom.gs.lrmi.filter.factory=com.gigaspaces.lrmi.nio.filters.SSLFilterFactory -Dcom.gs.lrmi.filter.security.keystore=C:/Users/Dixson/work/xap/gigaspaces-xap-premium-12.0.0-ga-b16000/bin/keystore.jks -Dcom.gs.lrmi.filter.security.password=changeit -Djava.net.preferIPv4Stack=true -Djavax.net.debug=ssl
</code></pre>
        <p>After you configure the environment variables, you can deploy your data grid by running the following CLI command from  <code>my-pc:&lt;XAP_home&gt;/bin</code>:</p><pre><code>&lt;XAP-HOME&gt;\bin\gs space deploy --partitions=2 --ha SSLSpace</code></pre>
        <h1>Client Server Setup</h1>
        <p>Compile the example SSLClient.java program provided in the <a href="https://docs.gigaspaces.com/latest/security/securing-the-transport-layer-using-ssl.html">documentation</a>. You may need to change the Groups and Locators values as needed.</p>
        <p>Below is the bash script I used to run the client:</p><pre><code class="language-bash">#!/bin/bash

export JAVA_HOME=/opt/jdk/jdk8u66

export XAP_LOOKUP_LOCATORS=my-pc.gspaces.com:4174
export XAP_LOOKUP_GROUPS=dixson_1
export XAP_NIC_ADDRESS=10.10.10.21

CLASSPATH=/home/user/sslclient
CLASSPATH=/opt/gspaces/gigaspaces-xap-premium-12.0.0-ga-b16000/bin:${CLASSPATH}
CLASSPATH=/opt/gspaces/gigaspaces-xap-premium-12.0.0-ga-b16000/lib/required/*:${CLASSPATH}


echo $CLASSPATH
${JAVA_HOME}/bin/java -cp ${CLASSPATH} \
-Dcom.gs.jini_lus.locators=${XAP_LOOKUP_LOCATORS} \
-Dcom.gs.jini_lus.groups=${XAP_LOOKUP_GROUPS} \
-Dcom.gs.lrmi.filter.factory=com.gigaspaces.lrmi.nio.filters.SSLFilterFactory \
-Dcom.gs.lrmi.filter.security.keystore=/opt/gspaces/gigaspaces-xap-premium-12.0.0-ga-b16000/bin/client_keystore.jks \
-Dcom.gs.lrmi.filter.security.password=changeit \
-Djava.net.preferIPv4Stack=true \
-Djavax.net.debug=ssl \
SSLClient
</code></pre>
        <h1><a name="verification">&#160;</a>Verification</h1>
        <p>The SSLSpace will have one object. By setting <code>-Djavax.net.debug=ssl</code> you will see the ssl handshake methods. If this is not enabled, you may get an error: <span class="tc-bold">General SSLEngine problem</span>, but it will be missing details.</p>
        <p>After enabling the debug option, you should see the following output in the logs:</p><pre><code class="language-bash">2016-12-15 14:19:35,661  INFO [com.gigaspaces.lrmi.filters] - Created LRMI filter factory: com.gigaspaces.lrmi.nio.filters.SSLFilterFactory
adding as trusted cert:
adding as trusted cert:
 Subject: CN=blob.gspaces.com, OU=Unknown, O=Gigaspaces, L=New York, ST=New York, C=US
 Subject: CN=blob.gspaces.com, OU=Unknown, O=Gigaspaces, L=New York, ST=New York, C=US
 Issuer:  CN=blob.gspaces.com, OU=Unknown, O=Gigaspaces, L=New York, ST=New York, C=US
 Issuer:  CN=blob.gspaces.com, OU=Unknown, O=Gigaspaces, L=New York, ST=New York, C=US
 Algorithm: RSA; Serial number: 0x6aebeb13
 Algorithm: RSA; Serial number: 0x6aebeb13
 Valid from Thu Dec 15 10:35:01 EST 2016 until Wed Mar 15 11:35:01 EDT 2017
 Valid from Thu Dec 15 10:35:01 EST 2016 until Wed Mar 15 11:35:01 EDT 2017

adding as trusted cert:

adding as trusted cert:
 Subject: CN=my-pc.gspaces.com, OU=Unknown, O=Gigaspaces, L=New York, ST=New York, C=US
 Subject: CN=my-pc.gspaces.com, OU=Unknown, O=Gigaspaces, L=New York, ST=New York, C=US
 Issuer:  CN=my-pc.gspaces.com, OU=Unknown, O=Gigaspaces, L=New York, ST=New York, C=US
 Issuer:  CN=my-pc.gspaces.com, OU=Unknown, O=Gigaspaces, L=New York, ST=New York, C=US
 Algorithm: RSA; Serial number: 0x2f54a1d6
 Algorithm: RSA; Serial number: 0x2f54a1d6
 Valid from Wed Dec 14 16:57:53 EST 2016 until Tue Mar 14 17:57:53 EDT 2017

 Valid from Wed Dec 14 16:57:53 EST 2016 until Tue Mar 14 17:57:53 EDT 2017
</code></pre>
        <p>If the certificate of the other computer is not listed, you will get an error:</p><pre><code class="language-bash">***
main, fatal error: 46: General SSLEngine problem
sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
</code></pre>
    </body>
</html>