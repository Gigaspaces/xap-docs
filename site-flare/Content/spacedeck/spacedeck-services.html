<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <map id="map1">
            <area shape="rectangle" coords="31,228,438,655" dragDirection="0" />
            <area shape="rectangle" coords="486,228,891,656" dragDirection="0" href="gs-ops-manager-cluster-overview.html" />
            <area shape="rectangle" coords="940,227,1349,656" dragDirection="0" />
        </map>
        <h1 class="tc-pagetitle">SpaceDeck – Services</h1>
        <p>This part of the system allows you to create and test queries using JDBC v3 format to  create and execute SQL-99 compliant low code data micro-services. Create a service by optionally defining parameters will that will be supplied on invocation of the exposed REST endpoint of that service. These services are used in client services, which are applications that interact with Spaces.</p>
        <p>Refer to the <a href="../admin/deploying-services.html"> deploying services</a> page for information about Service Creator which is the service driving service creation and management.</p>
        <div MadCap:conditions="Version.16-4-born">
            <h1><a name="SecurityRoles"></a>Security Roles &amp;&#160;Permissions</h1>
            <ul>
                <li>
                    <p>Security Roles and Permissions:</p>
                    <ul>
                        <li>
                            <p>Deploy/Undeploy actions will require special permission. A user without this permission can create or delete a service.  In order to deploy or undeploy it they will require <b>Manage Service</b> permission. Refer to <MadCap:xref href="../security/security-overview.html#service-authority">Security Overview</MadCap:xref> for more details. </p>
                        </li>
                        <li>
                            <p>Create/Delete does not require special permissions.</p>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        <div MadCap:conditions="Version.16-4-born">
            <h1>Service Main Page</h1>
            <p>If there are no services currently defined, the Service screen will appear like this:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Service1.png" style="width: 1110px;height: 373px;" />
            </p>
            <h2>Services&#160;Fields</h2>
            <ul>
                <li>
                    <p><b>SERVICE NAME</b> – The name of the service.</p>
                    <div class="tc-admon-note">
                        <p>The Service name must be in lower case and can contain numbers and one hyphen (-).</p>
                    </div>
                </li>
                <li>
                    <p><b>STATUS</b> – The status of the service:</p>
                    <ul style="list-style-type: circle;">
                        <li>
                            <p><b>Undeployed</b> - A service that has been created, deployed and is now undeployed. It can also be edited in this state.</p>
                        </li>
                        <li>
                            <p><b>Deployed</b> - Ready for external execution.</p>
                        </li>
                        <li>
                            <p><b>Created</b> - A service that has  been created but not yet deployed and can still be edited.</p>
                        </li>
                    </ul>
                </li>
                <li>
                    <p><b>SPACE&#160;NAME</b> – The name of the space to which the service is associated.</p>
                </li>
                <li>
                    <p><b>SWAGGER&#160;LINK</b> - The link to use in Swagger UI. For more details, refer to <a href="#Swagger">Service Execution through Swagger UI</a>.</p>
                </li>
                <li>
                    <p><b>DESCRIPTION</b> – a free-format description of the service</p>
                </li>
                <li>
                    <p><b>REPLICAS (ACTUAL/PLANNED)</b> – The amount of running replicas vs. requested replicas. If it is a large service, it is recommended to define more than 1 so it can be balanced over multiple instances.</p>
                </li>
            </ul>
            <h1>Create a New Service</h1>
            <p>From the main screen, click <b>Create New Service +</b> </p>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Service2.png" />
            </p>
            <p>The following configuration screen is displayed. The fields <span class="tc-textred">outlined in red</span> are mandatory. </p>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Service3c.png" style="width: 1040px;height: 685px;" />
            </p>
            <h2>Services Configuration Parameters</h2>
            <ol>
                <li>
                    <p><b>(Source drop-down list)</b> – Select which GigaSpaces Space object the service should be executed against. If there is more than one Source, then the specific source will have to be defined. If there is just one Source, this is defined automatically.</p>
                </li>
                <li>
                    <p><b>Service Name</b> - Provide a unique name for the new service. </p>
                    <div class="tc-admon-note">
                        <p>Only lowercase and numbers can be used including one hyphen and it has to start and end with a letter. </p>
                    </div>
                </li>
                <li>
                    <p><b>Replicas</b> - The number of replicas being used.</p>
                </li>
                <li>
                    <p><b>Description:</b>&#160;Write a short description of the service being created.</p>
                </li>
                <li>
                    <p><b>(Body of the service)</b> – Create a SQL-99 compliant service. Initially there is an example query service displayed in gray, As soon as you click on that area, it is replaced by a blank screen ready for you to create your service. The results of the example service are also displayed (in our example, these are SAMPLE_FIELD_1, SAMPLE_FIELD_2).</p>
                </li>
                <li>
                    <p><b>Retrieve first</b> – limit the query response to the desired number of rows. A maximum of 10,000 rows can be retrieved.</p>
                </li>
                <li>
                    <p><b>Run Query</b> -Click to test the query. The query results will be displayed. If there is a problem with the query a Query validation failed error will be displayed at the bottom of the screen, like this:</p>
                    <p>
                        <img src="../Resources/Images/SpaceDeck/16.4/ServiceCreateFail.png" />
                    </p>
                </li>
                <li>
                    <p><b>Create Service</b> - Click to create the service. It will now be displayed on the main screen with the status <b>Created</b>:</p>
                </li>
                <li>
                    <p><b>Saved Queries</b> - A list of previously saved queries.</p>
                </li>
                <li>
                    <p><b>Save Query</b> - Save the query which will then be accessible via the <b>Saved Queries</b> drop-down.</p>
                </li>
            </ol>
            <h2>Create Service&#160;Example</h2>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Services4a.png" style="width: 1002px;height: 570px;" />
            </p>
            <ol>
                <li>
                    <p>In the Configuration tab, create the query for the service. For requesting results pagination refer to <a href="#Pagination">Support for Service Results Pagination.</a></p>
                </li>
                <li>
                    <p>Click <b>Run Query</b> to test it.</p>
                </li>
                <li>
                    <p>The results are displayed.</p>
                </li>
                <li>
                    <p>The results can be exported to a .csv  file.</p>
                </li>
                <li>
                    <p><b>Save</b> the query.</p>
                </li>
                <li>
                    <p><b>Deploy</b> or <b>Undeploy</b> the query as a service. Depending on whether the status is Created or Deployed.</p>
                </li>
                <li>
                    <p>If the service is created, use this kebab menu to either <b>Deploy</b> or <b>Delete</b> the service. If the service is deployed, use this kebab menu to either <b>Download Logs</b>, <b>Undeploy Service</b> or <b>Go to API&#160;Docs</b>.</p>
                </li>
            </ol>
            <h2><a name="Pagination"></a>Support for Service Results Pagination</h2>
            <p>In some cases, services can return multiple rows from a Space.  If the goal is to display the data in some web application, the pagination approach is often used. This avoids all the data being displayed on one long page, which is not practical. Instead the data is divided into smaller pages.</p>
            <p>It is often required that services support this approach also on the back-end side because it is not practical to bring large amounts of data  to the front-end only to then divide it into smaller pages.  In many cases a developer will prefer to fetch relevant amounts of information for a given page from the front end. </p>
            <p>Pagination is now possible using a combination of service parameters together with <b>LIMIT</b> and <b>OFFSET</b> and <b>ORDER&#160;BY</b> SQL keywords.</p>
            <p> LIMIT defines the page size. OFFSET defines the first row for a given page. &#160;For OFFSET, a basic calculation is performed of page number minus one multiplied by page size. This will results in a request that returns data that is relevant for a given page instead of returned all the data.</p>
            <p>When using LIMIT, it is important to use an ORDER BY clause that constrains the result rows into a unique order. Otherwise you will get an unpredictable subset of the query's rows.</p>
            <p>Example (assuming ID is in the Person table):</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Pagination2.png" />
            </p>
            <h2>Deployed Service</h2>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Services5.png" style="width: 1230px;height: 625px;" />
            </p>
            <ol>
                <li>
                    <p>Once the service is deployed, there in a option from this screen to <b>Undeploy</b> the service.</p>
                </li>
                <li>
                    <p>Once deployed, use this kebab menu to either <b>Download Logs</b>, <b>Undeploy Service</b> or <b>Go to API&#160;Docs</b>. </p>
                    <p>For more details about <b>Logs</b>, refer to <a href="#Logs">Change Log Level Dynamically</a>.</p>
                    <p>For more details about <b>API&#160;Docs</b>, refer to <a href="#API-Docs">API&#160;Docs: Registering a Query Service to an API&#160;GW</a>.</p>
                </li>
            </ol>
            <h1>Service Main Page with Services Defined</h1>
            <p>The main Services screen displays a list of services. &#160;For our example, three services have been created all with different statuses.</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Services6b.png" style="width: 1227px;height: 226px;" />
            </p>
            <ol>
                <li>
                    <p><b>SERVICE NAME</b> – click this to get to the configuration screen.</p>
                </li>
                <li>
                    <p><b>STATUS</b> – The status of defined services.</p>
                </li>
                <ul>
                    <li>
                        <p><b>Deployed</b> - a service ready for external execution.</p>
                    </li>
                    <li>
                        <p><b>Undeployed</b>- a service that has been deployed or has been undeployed for editing purposes.</p>
                    </li>
                    <li>
                        <p><b>Created</b> - a service that has not been deployed and can still be edited.</p>
                    </li>
                </ul>
                <li>
                    <p>Once deployed, use this kebab menu to either <b>Download Logs</b>, <b>Undeploy Service</b> or <b>Go to API&#160;Docs</b>. </p>
                </li>
            </ol>
            <blockquote>
                <ul>
                    <li>
                        <p>If the service is in an <b>Undeployed</b> or <b>Created</b> state, the kebab menu options will be <b>Deploy Service</b> or <b>Delete Service</b>.</p>
                    </li>
                </ul>
            </blockquote>
        </div>
        <div MadCap:conditions="Version.16-4-born">
            <h1><a name="ServiceMonitoring"></a>Service Monitoring</h1>
            <p>For each deployed service, there is monitoring supplied through SpaceDeck. From the Services main page, click on a service and once in the next screen, click the Monitoring tab:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/ServiceMonitoring.png" style="width: 1331px;height: 568px;" />
            </p>
            <h2>Monitoring Types</h2>
            <ul>
                <li>
                    <p><b>Execution response trend over time</b> - monitored by Request Succeeded, Bad Request and Server Error</p>
                </li>
                <li>
                    <p><b>New execution response</b> - different view of Request Succeeded, Bad Request and Server Error</p>
                </li>
                <li>
                    <p><b>Execution latency in milliseconds</b> - displaying the service execution latency in milliseconds</p>
                </li>
            </ul>
        </div>
        <div MadCap:conditions="Version.16-4-born">
            <h1><a name="Swagger"></a>Service Execution through Swagger UI</h1>
            <p>There are two options to execute a service query. Either through the service URL&#160;endpoint or using Swagger UI (in the case where the SQL query has parameter placeholders there will be values to fill in. &#160;If not, there will be no parameter values listed). Through&#160;Swagger UI, a value must be entered for each parameter. In the case where there are no parameters, there will be no option given to enter parameters. In the example below, the Parameters and values supplied are id2 and id1:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Swagger1.png" style="width: 832px;height: 411px;" />
            </p>
            <p>Execution Results:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Swagger2.png" style="width: 832px;height: 560px;" />
            </p>
            <p>&#160;</p>
            <h1><a name="API-Docs"></a>API&#160;Docs: Registering a Query Service to an API&#160;GW</h1>
            <div class="tc-admon-note">
                <p>Only once a service has been deployed and the Swagger link is accessible (responds with 200 status) will the URL of the API Docs be available.</p>
            </div>
            <ol>
                <li>
                    <p>Through the kebab menu there is an option to Go to API&#160;Docs. This will open a JSON in Open API format which is used to register to an API Gateway.</p>
                </li>
                <img src="../Resources/Images/SpaceDeck/16.4/Service_APIGW1.png" style="width: 1207px;height: 151px;" />
                <li>
                    <p>Copy the contents of that page.</p>
                </li>
                <li>
                    <p>For our example we are using the AWS&#160;GW. Open this API&#160;GW and click <b>Create API</b>:</p>
                </li>
                <img src="../Resources/Images/SpaceDeck/16.4/Service_APIGW2.png" style="width: 1216px;height: 93px;" />
                <li>
                    <p>Select REST&#160;API&#160;and click import:</p>
                </li>
                <img src="../Resources/Images/SpaceDeck/16.4/Service_APIGW3.png" style="width: 1226px;height: 255px;" />
                <li>
                    <p>Select the option of <b>Import from Swagger or Open API 3</b> and paste the output of the API&#160;Docs (copied previously). Then click <b>Import</b>:</p>
                </li>
                <img src="../Resources/Images/SpaceDeck/16.4/Service_APIGW4.png" style="width: 1218px;height: 282px;" />
                <li>
                    <p>Under the single endpoint of the query, configure the following parameters:</p>
                    <p style="text-align: left;">
                        <img src="../Resources/Images/SpaceDeck/16.4/Service_APIGW5a.png" style="width: 943px;height: 393px;" />
                    </p>
                </li>
            </ol>
            <ul>
                <li>
                    <p><b>Integration type</b>: HTTP</p>
                </li>
                <li>
                    <p><b>Use Proxy Integration</b>: check this option</p>
                </li>
                <li>
                    <p><b>Method</b>: GET</p>
                </li>
                <li>
                    <p><b>Endpoint URL</b>:The endpoint of the service. In the example, it is the URI of the service without any additional query parameters.</p>
                </li>
                <li>
                    <p><b>Use Default Timeout</b>:&#160;check this option</p>
                </li>
            </ul>
            <h1><a name="Logs"></a>Logs and Changing the Log Level Dynamically</h1>
            <div class="tc-admon-attention">
                <p>Once a service has been undeployed the log is erased. Once the service is stopped and started the log level resets as there is a new internal ID created for the service. If there is more than one replica defined, they are contained in the single .zip file that is produced. &#160;</p>
            </div>
            <p>The default log level is configured to "INFO". Currently the ability to change the log level is not available through SpaceDeck. However, this can be achieved through CURL or using Postman.</p>
            <h2>Through Postman:</h2>
            <ol>
                <li>
                    <p>In the service's endpoint go the relative path: <code>/actuator/loggers/com.gigaspaces.mcs.service.query</code>. </p>
                </li>
                <li>
                    <p>Configure the request body <code>{"configuredLevel": "DEBUG"}</code>. </p>
                </li>
            </ol>
            <p>In the example below the name of the service is "get-people-by-id-range":</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/16.4/Service+LogLevel1.png" style="width: 1435px;height: 265px;" />
            </p>
            <h2>Through CURL</h2>
            <p><code>curl -X POST -H "Content-Type: application/json" -d '{"configuredLevel": "DEBUG"}' http://&lt;IP&#160;of cluster&gt;/api/get-people-by-id-range/actuator/loggers/com.gigaspaces.mcs.service.query</code>
            </p>
            <p>&#160;</p>
        </div>
        <div MadCap:conditions="Version.16-3-only">
            <p>The main screen displays a list of services. &#160;For our example, there have been three services created which have different statuses:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/SpaceDeck-Services1a.png" />
            </p>
        </div>
        <div MadCap:conditions="Version.16-3-only">
            <h2>Services&#160;Fields</h2>
            <ul>
                <li>
                    <p><b>SERVICE NAME</b> – the name you define to the data source</p>
                </li>
                <li>
                    <p><b>STATUS</b> – The status of the service:</p>
                    <ul style="list-style-type: circle;">
                        <li>
                            <p><b>Undeployed</b>: a service that has been deployed and is not undeployed for edit purposes.</p>
                        </li>
                        <li>
                            <p><b>Deployed:</b> Ready for external execution</p>
                        </li>
                        <li>
                            <p><b>Created:</b> a service that has not been deployed and can still be edited,</p>
                        </li>
                    </ul>
                </li>
                <li>
                    <p><b>SPACE&#160;NAME</b> – The name of the space to which the service is associated.</p>
                </li>
                <li>
                    <p><b>URL</b> – The URL of the service.</p>
                </li>
                <li>
                    <p><b>DESCRIPTION</b> – a free-format description of the service</p>
                </li>
                <li>
                    <p><b>REPLICAS</b> – The amount of replicas. If it is a large service, it is recommended to define more than 1 so it can be balanced over multiple instances.</p>
                </li>
            </ul>
            <h2>Create a Service - Configuration</h2>
            <p>From the main Services screen, click  <b>New +</b></p>
            <p>The following configuration screen is displayed - the mandatory fields are outlined in red:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/SpaceDeck-Services5.png" style="width: 850px;height: 535px;" />
            </p>
            <h2>Services Configuration Parameters</h2>
            <ul>
                <li>
                    <p><b>(Source drop-down list)</b> – Select which GigaSpaces Space object the service should be executed against.</p>
                </li>
                <li>
                    <p><b>Load Query</b>: Displays a list of previously saved and run queries.</p>
                </li>
                <li>
                    <p><b>Service Name:</b> Provide a unique name for the service.</p>
                    <div class="tc-admon-note">
                        <p>The service name must be in lower case and can contain numbers, but only one hyphen "-"</p>
                    </div>
                </li>
                <li>
                    <p><b>Replicas:</b> How many replicas are being used.</p>
                </li>
                <li>
                    <p><b>Description:</b>&#160;Description of the service you are creating.</p>
                </li>
                <li>
                    <p><b>(Body of the service)</b> – enter a SQL-99 compliant service. Initially there is an example query service displayed in gray, As soon as you lick on that area, it is replaced by a blank screen ready for you to create your service. The results of the example service are also displayed (MIN_AGE, MAX_AGE).</p>
                    <p><b>Retrieve first</b> – limit the query response to the desired number of rows. A maximum of 10,000 rows can be retrieved.</p>
                </li>
            </ul>
        </div>
        <div MadCap:conditions="Version.16-3-only">
            <h2>Run or Save the Query and Create the Service</h2>
            <p>Click <b>Run Query</b> to test the query. The query results will be displayed. If there is a problem with the query a Query validation failed error will be displayed at the bottom of the screen.</p>
            <p>Click <b>Save query</b> to save the query which will then be accessible via the <b>Load Query</b> drop-down.</p>
            <p>Click <b>Create Service</b> to create a service. It will now be displayed on the main screen with the status <b>Created</b>:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/SpaceDeck-Services6.png" style="width: 378px;height: 302px;" />
            </p>
            <h2><a name="DeployService"></a>Deploy the Service</h2>
            <p>Click the new service name and then to deploy the service, click <b>Deploy</b>:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/SpaceDeck-Services7.png" style="width: 761px;height: 434px;" />
            </p>
            <p>The newly created service will now be displayed on the main screen with the status <b>Deployed</b>:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/SpaceDeck-Services8.png" style="width: 396px;height: 322px;" />
            </p>
            <h2>Undeploy the Service</h2>
            <p>A deployed service can be undeployed by clicking the SERVICE&#160;NAME and clicking <b>Undeploy</b>:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/SpaceDeck-Services9.png" style="width: 764px;height: 504px;" />
            </p>
            <p>The undeployed service will now be displayed on the main screen with the status <b>Undeployed</b>:</p>
            <p>
                <img src="../Resources/Images/SpaceDeck/SpaceDeck-Services10.png" style="width: 408px;height: 342px;" />
            </p>
            <div>
                <h2>Delete a Service</h2>
                <p>There is an option to Undeploy and then Delete a service by clicking the kebab menu (vertical three-dot menu) on the far right of the main Services Fields:</p>
                <p>
                    <img src="../Resources/Images/SpaceDeck/SpaceDeck-Services1b.png" style="width: 908px;height: 135px;" />
                </p>
                <p>Then select <b>Undeploy</b> and then <b>Delete</b> the service: </p>
                <p>
                    <img src="../Resources/Images/SpaceDeck/SpaceDeck-Services11a.png" />
                </p>
            </div>
        </div>
        <p>&#160;</p>
    </body>
</html>