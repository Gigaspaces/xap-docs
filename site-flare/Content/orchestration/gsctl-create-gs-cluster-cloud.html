<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1 class="tc-pagetitle">Creating a <MadCap:variable name="General.ProductNameXAP" /> Cluster in the Cloud</h1>
        <p>&#160;</p>
        <p>gsctl is a simple CLI tool for creating <MadCap:variable name="General.ProductNameXAP" /> clusters. You can create a cluster in minutes with a single command – <code>run java -jar gsctl.jar create</code>.</p>
        <p>In this topic, you will learn how to create, provision and install a <MadCap:variable name="General.ProductNameXAP" /> cluster on Amazon Web Services (AWS) and then remove it by doing the following:</p>
        <ul>
            <li>Create a <MadCap:variable name="General.ProductNameXAP" /> cluster.</li>
            <li>Deploy <MadCap:variable name="General.ProductNameXAP" /> services in the cluster.</li>
            <li>Undeploy the <MadCap:variable name="General.ProductNameXAP" /> services and tear down the cluster.</li>
        </ul>
        <h2>Prerequisites</h2>
        <p>Before beginning to work with the gsctl tool, ensure that you have the following:</p>
        <ul>
            <li>
                <p>Java 8 or higher installed on your local workstation.</p>
            </li>
            <li>
                <p>AWS&#160;account and appropriate credentials as described in the <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" target="_blank">AWS Command Line Interface documentation</a>.</p>
                <div class="tc-admon-note">
                    <p>To deploy a <MadCap:variable name="General.ProductNameXAP" /> cluster in AWS you need the following:</p>
                    <ul>
                        <li>Valid AWS&#160;account</li>
                        <li>Credentials that include <code>aws_access_key_id</code> and <code>aws_secret_access_key</code></li>
                        <li>Configuration parameters that include a defined <code>region</code></li>
                    </ul>
                </div>
            </li>
            <li><span class="tc-bold">Windows only</span>:&#160;Set the following environment variables manually:<ul><li>AWS_ACCESS_KEY_ID</li><li>AWS_SECRET_ACCESS_KEY</li><li>REGION</li></ul></li>
        </ul>
        <h2>Downloading the Utility</h2>
        <p>The gsctl tool is available from the<MadCap:variable name="General.ProductNameXAP" /> <a href="https://github.com/Gigaspaces/gsctl" target="_blank">Github repo</a>.</p>
        <h1>Creating a <MadCap:variable name="General.ProductNameXAP" /> Cluster </h1>
        <p>Follow the steps in the procedure to create a <MadCap:variable name="General.ProductNameXAP" /> cluster and deploy the <MadCap:variable name="General.ProductNameXAP" /> services.</p>
        <p class="tc-todo">To create a cluster:</p>
        <ol>
            <li>
                <p>Verify that an <code>.aws</code> folder exists in the home directory on your local machine, and that it contains the config and credentials files. The credentials file should include your <code>aws_access_key_id</code> and <code>aws_secret_access_key</code>, and the config files should include your <code>region</code> and <code>output</code> definitions.</p>
                <p>
                    <img src="../Resources/Static/attachment_files/gigaops-stack/cloud-config-files.png" class="tc-picture30" />
                </p>
            </li>
            <li>
                <p>Create an empty directory on your machine. In this example, the directory name is <span class="tc-bold">gsDemo</span>.</p>
            </li>
            <li>Download the most current version of the gsctl.jar file from <a href="https://github.com/Gigaspaces/gsctl" target="_blank">Github</a> to the directory you created (gsDemo) and extract the contents.</li>
            <li>
                <p>Open a command window and type the following:</p><pre><code class="language-bash">java -jar gsctl.jar init --cluster-name=gs_demo_cluster</code></pre>
                <p>This command creates a provision.yml file. You can modify this file to supply your AWS&#160;resources, such as <code>VPC</code>, <code>keyName</code>, and <code>securityGroups</code> values.</p>
                <div class="tc-admon-note">
                    <p>If you don't update the provision.yml file manually, it will use the resources in the .aws folder.</p>
                </div><pre><code class="language-bash">aws:
  keyName: null
  vpcId: null
  vpcSubnetId: null
  securityGroup: null
  amiId: null
  userName: null
servers:
  label: "GS Cluster [GS_CLUSTER] Server Group"
  groups:
  - type: "m4.xlarge"
    tags: null
    count: 3
clients:
  label: "GS Cluster [GS_CLUSTER] Client Group"
  groups:
  - type: "m4.xlarge"
    tags: null
    count: 3
gsManagers: 3
name: "GS_CLUSTER"</code></pre>
            </li>
            <li>
                <p>To create a cluster, run the following command:</p><pre><code class="language-bash">java -jar gsctl.jar create</code></pre>
                <p>The cloud platform begins to create the cluster:</p>
                <p>
                    <img src="../Resources/Static/attachment_files/gigaops-stack/gsctl-create-cluster-new.png" class="tc-picture50" />
                </p>
                <p>You can monitor the progress of the cluster in your cloud platform dashboard, for example the VPC&#160;Dashboard in AWS:</p>
                <p>
                    <img src="../Resources/Static/attachment_files/gigaops-stack/aws-vpc-dashboard-create-cluster.png" class="tc-picture80" />
                </p>
                <p>The process of creating the cluster takes only a few minutes until the nodes are up and running. You can see when the Master (server) nodes and Worker (client) nodes are running and have passed the status checks.</p>
                <p>
                    <img src="../Resources/Static/attachment_files/gigaops-stack/cloud-cluster-running.png" class="tc-picture80" />
                </p>
            </li>
        </ol>
        <h1>Deploying the <MadCap:variable name="General.ProductNameXAP" /> Services</h1>
        <p>After your cluster is up and running, you can deploy the <MadCap:variable name="General.ProductNameXAP" /> services. The gsctl tool comes with sample feeder and processor services in the Services folder.</p>
        <p class="tc-todo">To deploy the sample <MadCap:variable name="General.ProductNameXAP" /> services:</p>
        <ol>
            <li>
                <p>First, deploy the stateful service (the Space example). Type the following command to deploy a processor service called <span class="tc-bold">mySpace</span>:</p><pre><code class="language-bash">java -jar gsctl.jar deploy stateful mySpace processor.jar</code></pre>
            </li>
            <li>
                <p>Next, deploy the stateless service (the feeder example). Type the following command to deploy a feeder service called <span class="tc-bold">myFeeder</span>:</p><pre><code>java -jar gsctl.jar deploy stateless myFeeder feeder.jar</code></pre>
                <p>A feeder service called myFeeder is deployed.</p>
            </li>
            <li>
                <p>Now you can monitor your services using the available administration and monitoring tools. To access the tools, do the following:</p>
                <ul>
                    <li>
                        <p>Run the following command:</p><pre><code>java -jar gsctl.jar list-services</code></pre>
                        <p>This returns all the manager services with their URLs.</p>
                        <p>
                            <img src="../Resources/Static/attachment_files/gigaops-stack/gsctl-list-services.png" class="tc-picture50" />
                        </p>
                    </li>
                    <li>
                        <p>Copy any of the manager URLs into your browser to open Ops Manager and view the deployed <MadCap:variable name="General.ProductNameXAP" /> services.</p>
                        <p>
                            <img src="../Resources/Static/attachment_files/gigaops-stack/cloud-cluster-ops-manager.png" class="tc-picture80" />
                        </p>
                    </li>
                    <li>
                        <p>Copy the grafana URL to your browser to open Grafana and navigate to the pre-defined dashboards:</p>
                        <p>
                            <img src="../Resources/Static/attachment_files/gigaops-stack/cloud-cluster-grafana.png" class="tc-picture80" />
                        </p>
                    </li>
                    <li>
                        <p>Select the Telegraf system metrics dashboard in Grafana to view the cluster metrics.</p>
                        <p>
                            <img src="../Resources/Static/attachment_files/gigaops-stack/cloud-cluster-telegraf.png" class="tc-picture80" />
                        </p>
                    </li>
                </ul>
            </li>
        </ol>
        <h1>Removing a <MadCap:variable name="General.ProductNameXAP" /> Cluster</h1>
        <p>You can delete your cluster when you no longer need it, in order to release the cloud resources. First, undeploy the <MadCap:variable name="General.ProductNameXAP" /> stateful service, and then tear down the cluster.</p>
        <p class="tc-todo">To remove the <MadCap:variable name="General.ProductNameXAP" /> cluster:</p>
        <ol>
            <li>
                <p>In the directory where you deployed the <MadCap:variable name="General.ProductNameXAP" /> services, type the following command:</p><pre><code class="language-bash">java -jar gsctl.jar undeploy mySpace</code></pre>
                <p>The Space is undeployed from the cluster.</p>
            </li>
            <li>
                <p>In the directory where you created the cluster, run the following command:</p><pre><code class="language-bash">java -jar gsctl.jar destroy</code></pre>
                <p>This tears down the cluster and deletes any dynamically created resources.</p>
                <p>
                    <img src="../Resources/Static/attachment_files/gigaops-stack/gsctl-destroy-process.png" class="tc-picture50" />
                </p>
            </li>
        </ol>
    </body>
</html>