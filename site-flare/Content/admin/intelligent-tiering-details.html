<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1 class="tc-pagetitle">Tiered Storage</h1>
        <p>Tiered Storage provides seamless tiering of data between different storage tiers, to balance performance and storage media costs.</p>
        <input id="dfb_toc_here" type="hidden"> </input>
        <h1>Where is Data Stored in Tiered Storage?</h1>
        <p>Data can be stored in two tiers:</p>
        <ul>
            <li>
                <p><b>Hot Tier</b> <b>— RAM</b>: Priority data, used for read/write operations and analysis requiring fastest access</p>
            </li>
            <li>
                <p><b>Warm Tier — SSD</b> (recommended media): Additional data used mostly for read-only, analytical purposes</p>
            </li>
        </ul>
        <p>By defining business rules, you direct the system which data to store in the Hot tier and which in the Warm tier. The Hot/Warm decision can be based on the data content, or by data aging considerations. </p>
        <p>Using Tiered Storage can increase effective data capacity by a factor of ten.</p>
        <p style="text-align: center;">
            <img src="../Resources/Images/x16.0-tiered-storage-no-border.png" style="width: 595px;height: 382px;" />
        </p>
        <h1>Optimizing the Use of Tiered Storage</h1>
        <p>In order to get the most out of this feature, please note the following:</p>
        <ul>
            <li>
                <p>Data in the Hot tier is also stored in the Warm tier (except for transient objects — <a href="#transient-param">see below</a>). </p>
            </li>
            <li>
                <p>Queries use the Hot tier if all of the required data is in the Hot tier.</p>
            </li>
            <li MadCap:conditions="Default.DoNotShow">
                <p>Tiered Storage supports primitive property types, and Java Timestamp and Instant classes .</p>
            </li>
            <li>
                <p>Primitive property types and selected Java classes are supported in Tiered Storage. See <MadCap:xref href="tiered-storage-date-types.html">Tiered Storage Date Types</MadCap:xref> for a complete list of supported date types. </p>
            </li>
            <li MadCap:conditions="Default.DoNotShow">
                <p>Warm storage is not automatically persistent. Persistence is established via the standard <MadCap:xref href="../dev-java/persistency-for-a-database.html">Space Persistency</MadCap:xref> feature of <MadCap:variable name="General.ProductNameIE" />.</p>
            </li>
        </ul>
        <div class="tc-admon-note">
            <p>For tables configured as Tiered Storage (see below), if no rules are defined for the table, its data will be stored in the Warm tier only.</p>
        </div>
        <div class="tc-admon-note">
            <p>For ServiceGrid SLA, the Processing Unit must specify the <a href="https://docs-staging.gigaspaces.com/[%=Versions.xap-release%]/admin/the-sla-zones.html#InstanceLevelRequirements">instance level SLA with host requirement</a> for each instance or alternatively, specify  <code>pu.autogenerated-instance-sla=true</code> as a context property of the deployment. This will allow the system to automatically generate the SLA .</p>
        </div>
        <div class="tc-admon-note">
            <p>For ServiceGrid, each instance is bound to a specific machine for the entire duration of the deployment. Redeployment is only possible with the <b>same </b>schema, unless delete was called.</p>
        </div>
        <div MadCap:conditions="NewSet.JustAColorForDivs">
            <h1><a name="How"></a>How to Configure Tiered Storage in XML</h1>
            <div class="tc-admon-note" MadCap:conditions="Version.16-2-born">
                <p>Multiple criteria may be specified, separated by AND or OR.</p>
            </div>
            <p>Tiered Storage is implemented by parameters coded in the XML file for the Space. The relevant sections of the XML file are shown below.</p>
            <h3>Sample XML Code</h3>
            <p MadCap:conditions="Version.16-2-born"><a name="The"></a>The following XML specifies that for the table named <b>Customer</b>, records where the <b>club</b> field is equal to "<b>Platinum</b>", and also the <b>age</b> field is greater than <b>50</b>, will be in Hot storage and Warm storage. Other records will be in Warm storage only.</p><pre MadCap:conditions="Version.16-2-born"><code class="language-xml">        
&lt;os-core:tiered-storage-policy&gt;
 &lt;os-core:tables&gt; 
 &lt;os-core:table name="com.mycompany.app.model.<b>Customer</b>"&gt;
 &lt;os-core:cache-rule criteria="<b>club='PLATINUM'</b> and <b>age &gt; 50</b>"/&gt;
 &lt;/os-core:table&gt;
 &lt;/os-core:tables&gt;
&lt;/os-core:tiered-storage-policy&gt;
</code></pre>
            <p MadCap:conditions="Version.16-2-died"><a name="The"></a>The following XML specifies that for the table named <b>Order</b>, the <b>orderTime</b> field will be compared to the current time. For records where the orderTime field is within 24 hours of the current time, the records will be in Hot storage and Warm storage. If this condition is not met, the records will be in Warm storage only.</p><pre MadCap:conditions="Version.16-2-died"><code class="language-xml">        
&lt;os-core:tiered-storage&gt;
 &lt;os-core:tables&gt;
 &lt;os-core:table name="com.mycompany.app.model.Order" time-column="orderTime"&gt;
 &lt;os-core:cache-rule period="PT24H"/&gt;
 &lt;/os-core:table&gt;
 &lt;/os-core:tables&gt;
&lt;/os-core:tiered-storage&gt;
</code></pre>
            <p>&#160;</p>
            <p><a name="The2"></a>The following XML specifies that for the table named <b>Customer</b>, the <b>club</b> field will be compared to the string "<b>PLATINUM</b>". Matching records be in Hot storage and Warm storage. Other records will be in Warm storage only.</p>
            <p><a name="It"></a>It also specifies that for the <b>TransientCustomer</b> table, all data will be stored in Hot storage only. </p><pre><code class="language-xml">              
&lt;os-core:tiered-storage<MadCap:conditionalText MadCap:conditions="Version.16-2-born"><code class="language-xml">-policy</code></MadCap:conditionalText>&gt;
 &lt;os-core:tables&gt;
 &lt;os-core:table name="com.mycompany.app.model.<b>Customer</b>"&gt;
 &lt;os-core:cache-rule criteria="<b>club</b> <b>=</b> <b>'PLATINUM'</b>"/&gt;
 &lt;/os-core:table&gt;
 &lt;os-core:table name="com.mycompany.app.model.<b>TransientCustomer</b>" <b>transient="true"</b>/&gt;
 &lt;/os-core:tables&gt;
&lt;/os-core:tiered-storage<MadCap:conditionalText MadCap:conditions="Version.16-2-born">-policy</MadCap:conditionalText>&gt;</code></pre>
            <p>&#160;</p>
            <p>Following is a summary of XML parameters.</p>
            <table style="width: 100%;">
                <col />
                <col />
                <tbody>
                    <tr>
                        <td>XML Parameter</td>
                        <td>Meaning</td>
                    </tr>
                    <tr>
                        <td><code>tiered-storage</code>
                        </td>
                        <td>Beginning of Tiered Storage definitions for a Space</td>
                    </tr>
                    <tr>
                        <td><code>tables</code>
                        </td>
                        <td>Beginning of list of tables</td>
                    </tr>
                    <tr>
                        <td><code>table name=<i>name-of-table</i></code>
                        </td>
                        <td>Tiered rule for a table (object type)</td>
                    </tr>
                    <tr>
                        <td><code>time-column=<i>name-of-field</i></code>
                        </td>
                        <td>Name of the field (property) in the table that will be evaluated for eviction from RAM. Must be of Java type <code class="language-java">TimeStamp</code>, <code class="language-java">Long </code>or <code class="language-java">Instant</code>.<br /></td>
                    </tr>
                    <tr>
                        <td><code>period=<i>period</i></code>
                        </td>
                        <td>After the <code style="font-style: italic;">period</code> amount of time has passed, it will be removed from Hot storage (RAM). <br /><code style="font-style: italic;">period</code> must be a format supported by the Java <a href="https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#i49:~:text=occurs-,parse,public static Duration parse(CharSequence text)">Duration</a> class.<br />Examples: <br /><code>PT15M</code> (15 minutes)<br /><code>PT20S</code> (20 seconds)<br /></td>
                    </tr>
                    <tr>
                        <td><code>cache-rule criteria="<i>fieldname operator value</i>"</code>
                        </td>
                        <td>
                            <p>Rule to determine which data to place in Hot storage. <br /><code style="font-style: italic;">fieldname</code> can be any Java primitive field type. <br /><code style="font-style: italic;">operator</code> can be 
							<b>= &#160;&#160;!= &#160;&#160;&gt;= &#160;&#160;&lt;=  </b><br /><code style="font-style: italic;">value</code> is a compatible value for comparision to the field.</p>
                            <p>Examples: </p>
                            <p><code>cache-rule criteria="club! = 'BASIC'"</code>
                            </p>
                            <p><code>cache-rule criteria="active = true"</code>
                            </p>
                            <p><code>cache-rule criteria="age &gt;=30'"</code>
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td><code>cache-rule criteria="all"</code>
                        </td>
                        <td>Place all data in both Hot and Warm storage</td>
                    </tr>
                    <tr>
                        <td id="transient-param"><code>transient=<i>true</i>|<i>false</i></code>
                        </td>
                        <td>Specify if the data is in the Hot tier only. Default is <code>transient=false</code>.</td>
                    </tr>
                    <tr MadCap:conditions="Default.DoNotShow">
                        <td><code>period=<i>timevalue</i></code>
                        </td>
                        <td>The Hot tier eviction rule. Data failing this rule will be removed from the Hot tier (but will still be in the Warm tier). <code style="font-style: italic;">timevalue </code>can be any value that is a valid for the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Duration.html#parse(java.lang.CharSequence):~:text=public static Duration parse​(CharSequence text)">parse method of a Java Duration object</a>. </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div MadCap:conditions="NewSet.JustAnotherColorForDivs">
            <h1>How to Configure Tiered Storage in Java Code</h1>
            <p>Tiered Storage is implemented by setting parameter values in the Java code definition for the Space. Relevant parts of the Java code are shown below.</p>
            <h2>Sample Java Code</h2>
            <p>The following Java code specifies that for the table named <b>Customer</b>, the <b>club</b> field will be compared to the string "<b>PLATINUM</b>". Matching records will be stored in Hot storage and Warm storage. Other records will be in Warm storage only.</p>
            <p>It also specifies that for the <b>TransientCustomer</b> table, all data will be stored in Hot storage only.</p>
            <p>In addition, records in the <b>Purchase</b> table will be stored in Hot and Warm storage for 30 seconds. After that time, they will be stored in Warm storage only.</p>
            <h3 MadCap:conditions="Version.16-2-born">Declare Tiered Storage When Starting the Space</h3><pre MadCap:conditions="Version.16-2-born"><code class="language-java"> 
@Override 
protected void configure(EmbeddedSpaceFactoryBean factoryBean) {
super.configure(factoryBean); 
TieredStorageConfig tieredStorageConfig = new TieredStorageConfig();
tieredStorageConfig.addTable(new TieredStorageTableConfig().setName("<b>Customer</b>").setCriteria("<b>club =  'PLATINUM'</b>"));
tieredStorageConfig.addTable(new TieredStorageTableConfig().setName("<b>TransientCustomer</b>").setTransient(true));
tieredStorageConfig.addTable(new TieredStorageTableConfig().setName("<b>Purchase</b>").setTimeColumn("expire").setPeriod(Duration.ofSeconds(30)));
factoryBean.setCachePolicy(new TieredStorageCachePolicy(tieredStorageConfig));
</code></pre>
            <div MadCap:conditions="Version.16-2-born">
                <h3>Declare Tiered Storage When Introducing a New Type </h3>
                <div class="tc-admon-note">
                    <p>Refer to <MadCap:xref href="../dev-java/document-api.html" class="Schema-Evolution">Schema Evolution</MadCap:xref> for a discussion of adding new object types and properties dynamically to the GigaSpaces environment.</p>
                </div><pre MadCap:conditions="Version.16-2-born"><code class="language-java"> 
SpaceTypeDescriptor typeDescriptorDoc3 = new SpaceTypeDescriptorBuilder("<b>Customer</b>").supportsDynamicProperties(false)
    .idProperty("id")
    .addFixedProperty("<b>club</b>", String.class)
    .addFixedProperty("type", String.class)
    .addFixedProperty("id", Integer.class)
    .setTieredStorageTableConfig(new TieredStorageTableConfig()
        .setName("<b>club</b>")
        .setCriteria("<b>club =  'PLATINUM'</b> ")
    ).create();

</code></pre>
            </div><pre MadCap:conditions="Version.16-2-died"><code class="language-java"> @Override 
protected void configure(EmbeddedSpaceFactoryBean factoryBean) {
 super.configure(factoryBean); 
 TieredStorageConfig tieredStorageConfig = new TieredStorageConfig(); 
 Map&lt;String, TieredStorageTableConfig&gt; tables = new HashMap&lt;&gt;();
 tables.put(<b>Customer</b>.class.getName(), new TieredStorageTableConfig().sethame(Customer.class.getName()).<b>setCriteria("club =  'PLATINUM'")</b>); 
 tables.put(<b>TransientCustomer</b>.class.getName(), new TieredStorageTableConfig().setName(TransientCustomer.class.getName()).<b>setTransient(true)</b>); 
 tables.put(<b>Purchase</b>.class.getName(), new TieredStorageTableConfig.setName(Purchase.class.getName().setTimeColumn("orderTime").<b>setPeriod(Duration.ofSeconds(30)</b>));
 tieredStorageConfig.setTables(tables); 
 factoryBean.setTieredStorageConfig(tieredStorageConfig); 
</code></pre>
            <p>&#160;</p>
            <div MadCap:conditions="NewSet.JustAColorForDivs">
                <p>Following is a summary of the relevant Java code.</p>
                <table style="width: 100%;">
                    <col>
                    </col>
                    <col>
                    </col>
                    <tbody>
                        <tr>
                            <td>Code</td>
                            <td>Meaning</td>
                        </tr>
                        <tr>
                            <td>Customer.class.getName()).<b>setCriteria("club =  'PLATINUM'")</b></td>
                            <td>
                                <p>Rule to determine which data to place in Hot storage. <br />In this example, rows of data in the <i>Customer</i> table are placed in Hot storage is the <i>club</i> field is equal to "PLATINUM".</p>
                                <p>Note that the <code style="font-style: italic;">operator</code> can be 
							<b>= &#160;&#160;!= &#160;&#160;&gt;= &#160;&#160;&lt;=  </b></p>
                            </td>
                        </tr>
                        <tr>
                            <td>TransientCustomer.class.getName()).<b>setTransient(true)</b></td>
                            <td>Rule to determine which data is in Hot storage only. <br />In this example, all data in the TransientCustomer table is stored in Hot storage, but not in Warm storage.</td>
                        </tr>
                        <tr>
                            <td>Purchase.class.getName().setTimeColumn("orderTime")<br />.<b>setPeriod(Duration.ofSeconds(30)</b>)</td>
                            <td>Rule to specify the amount of time that certain data will be in Hot storage. <br />In this example, for the <i>Purchase</i> table, the <i>orderTime</i> fields will be kept in Hot storage for 30 seconds.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <p>&#160;</p>
    </body>
</html>